"use strict";var e=require("../../../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+t+(()=>"../../../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t=()=>"../../../../../components/Message/index.js",n=e.defineComponent({__name:"index",setup(t){const n=e.pn.getCurrentUserInfo().uid,a=e.ref(null),i=e.ref(""),o=e.ref(),c=e.ref(),l=()=>{n?a.value.open("bottom"):e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})},u=()=>{a.value.close()},s=()=>{c.value?e.pn.callFunction({name:"comment",data:{type:0,comment:c.value,topicId:o.value,userId:n,avatarUrl:d.avatar_file.url,nickname:d.nickname},success(){c.value="",g(),a.value.close(),e.index.showToast({title:"评论成功",icon:"none"})},fail(e){console.log(e)}}):e.index.showToast({title:"请输入内容"})},r=e.reactive({avatar_file:{url:""},nickname:"",_id:""}),d=e.reactive({avatar_file:{url:""},nickname:"",_id:""}),p=e.reactive({content:"",image:[],user_id:"",create_time:0}),m=e.ref([]),v=e.pn.database(),_=e.ref(),f=()=>{v.collection("collect").where(`user_id=='${n}'&&topic_id=='${o.value}'`).get({getOne:!0}).then((e=>{e.result.data?_.value=!0:_.value=!1}))},h=()=>{_.value?v.collection("collect").where(`user_id=='${n}'&&topic_id=='${o.value}'`).remove().then((()=>{f()})):e.pn.callFunction({name:"collect",data:{type:4,topicId:o.value,userId:n},success(){f(),e.index.showToast({title:"成功点赞"})}})},g=()=>{v.collection("comment").where(`topic_id=='${o.value}'&&comment_type==0`).get().then((e=>{m.value=e.result.data}))};return e.onLoad((async e=>{o.value=e.id,await v.collection("topic").where(`_id=='${e.id}'`).field("image,content,user_id,create_time").get({getOne:!0}).then((e=>{Object.assign(p,e.result.data),i.value=`topic_id=='${o.value}'&&comment_type==1`,f()})).then((()=>{v.collection("uni-id-users").where(`_id=='${p.user_id}'`).field("nickname,avatar_file").get({getOne:!0}).then((e=>{Object.assign(r,e.result.data)}))})).then((()=>{v.collection("uni-id-users").where(`_id=='${n}'`).field("nickname,avatar_file").get({getOne:!0}).then((e=>{Object.assign(d,e.result.data)}))})).then((()=>{g()}))})),(t,n)=>({a:r.avatar_file.url,b:e.t(r.nickname),c:e.p({date:p.create_time,format:"yyyy-MM-dd hh:mm:ss"}),d:e.t(p.content),e:e.f(p.image,((e,t,n)=>({a:e.path,b:t}))),f:e.p({type:"info",size:"20",color:"#ccc"}),g:e.p({commentList:m.value,where:i.value}),h:e.o(l),i:e.o(h),j:e.p({type:"hand-up",size:"26",color:_.value?"#ec9312":"#ccc"}),k:e.o(u),l:e.p({type:"closeempty",size:"30"}),m:e.o(s),n:c.value,o:e.o((e=>c.value=e.detail.value)),p:e.sr(a,"dd6c0dde-4",{k:"popup"}),q:e.p({type:"bottom"})})}});var a=e._export_sfc(n,[["__scopeId","data-v-dd6c0dde"]]);wx.createPage(a);
