"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const a=e.defineComponent({__name:"index",setup(a){const t=e.ref(5),n=e.ref(0),o=e.ref(2),i=e.reactive({phone:{rules:[{required:!0,errorMessage:"手机号不能为空"},{pattern:"^\\+?[0-9-]{3,20}$",errorMessage:"请输入正确的手机号"}]},city:{rules:[{required:!0,errorMessage:"请选择所在的城市"}]},work:{rules:[{required:!0,errorMessage:"请输入职业"}]},wxCode:{rules:[{required:!0,errorMessage:"请输入微信号"}]}}),r=e=>{t.value=e.detail.value,h.age=m[e.detail.value]},l=e=>{n.value=e.detail.value,h.house=v[e.detail.value]},d=e=>{o.value=e.detail.value,h.income=g[e.detail.value]},c=e=>{h.city.push(e.detail.value[0].text),h.city.push(e.detail.value[1].text),h.city.push(e.detail.value[2].text)},s=e.reactive([{value:0,text:"女铲屎官"},{value:1,text:"男铲屎官"}]),u=e.reactive([{value:0,text:"有"},{value:1,text:"无"}]),p=e.reactive([{value:0,text:"有猫"},{value:1,text:"有狗"},{value:2,text:"猫狗"},{value:3,text:"无"}]),x=e.reactive([{value:0,text:"单身"},{value:1,text:"恋爱"},{value:2,text:"已婚"}]),m=["40后","50后","60后","70后","80后","90后","00后","10后"],v=["自有住房","整租","合租","其他"],g=["小于3千","3-6千","6千-1万","一万以上"],h=e.reactive({adoptId:"",age:m[t.value],genderIndex:0,experienceIndex:0,presentIndex:0,house:v[n.value],marriageIndex:0,income:g[o.value],work:"",city:[],phone:"",wxCode:"",sincerity:"",state:""}),I=e.pn.database(),y=e.ref(!1),f=s.map((e=>e.text)),w=u.map((e=>e.text)),b=x.map((e=>e.text)),k=p.map((e=>e.text));e.onLoad((async a=>{const i=e.pn.getCurrentUserInfo().uid;h.adoptId=a.adoptId,await I.collection("apply").where(`adopt_id=='${h.adoptId}'&&user_id=='${i}'&&state=='申请中'`).get().then((e=>{e.result.data[0]?y.value=!0:y.value=!1})).then((()=>{y.value&&I.collection("apply").where(`adopt_id=='${h.adoptId}'&&user_id=='${i}'`).get().then((e=>{const a=e.result.data[0];h.sincerity=a.sincerity,h.work=a.work,h.phone=a.phone,t.value=m.indexOf(a.age),n.value=v.indexOf(a.house),o.value=g.indexOf(a.income),h.wxCode=a.wx_code,h.genderIndex=f.indexOf(a.gender),h.experienceIndex=w.indexOf(a.experience),h.marriageIndex=b.indexOf(a.marriage),h.presentIndex=k.indexOf(a.present)}))}))}));const _=e.ref(null),C=async()=>{y.value?_.value.validate().then((()=>{I.collection("apply").update({adopt_id:h.adoptId,age:h.age,gender:s[h.genderIndex].text,experience:u[h.experienceIndex].text,present:p[h.presentIndex].text,house:h.house,marriage:x[h.marriageIndex].text,income:h.income,work:h.work,city:h.city,phone:h.phone,wx_code:h.wxCode,sincerity:h.sincerity,state:"申请中"})})).then((()=>{e.index.navigateBack()})):await _.value.validate().then((()=>{e.pn.callFunction({name:"apply",data:{adoptId:h.adoptId,age:h.age,gender:s[h.genderIndex].text,experience:u[h.experienceIndex].text,present:p[h.presentIndex].text,house:h.house,marriage:x[h.marriageIndex].text,income:h.income,work:h.work,city:h.city,phone:h.phone,wxCode:h.wxCode,sincerity:h.sincerity,state:"申请中"},success(){e.index.showToast({title:"申请成功"}),e.index.redirectTo({url:"/pages/Mine/Request/Apply/index"})},fail(e){console.log(e)}})})).catch((e=>{console.log(e)}))};return(a,I)=>({a:e.o((e=>h.genderIndex=e)),b:e.p({mode:"tag",localdata:s,modelValue:h.genderIndex}),c:e.p({name:"genderIndex",label:"性别"}),d:e.t(m[t.value]),e:e.p({type:"right",size:"23",color:"#ccc"}),f:e.o(r),g:t.value,h:m,i:e.p({name:"age",label:"年龄"}),j:e.o((e=>h.experienceIndex=e)),k:e.p({mode:"tag",localdata:u,modelValue:h.experienceIndex}),l:e.p({name:"experienceIndex",label:"养宠经验"}),m:e.o((e=>h.presentIndex=e)),n:e.p({mode:"tag",localdata:p,modelValue:h.presentIndex}),o:e.p({name:"presentIndex",label:"目前宠物"}),p:e.t(v[n.value]),q:e.p({type:"right",size:"23",color:"#ccc"}),r:e.o(l),s:n.value,t:v,v:e.p({name:"house",label:"住房情况"}),w:e.o((e=>h.marriageIndex=e)),x:e.p({mode:"tag",localdata:x,modelValue:h.marriageIndex}),y:e.p({name:"marriageIndex",label:"婚姻状况"}),z:e.t(g[o.value]),A:e.p({type:"right",size:"23",color:"#ccc"}),B:e.o(d),C:o.value,D:g,E:e.p({name:"income",label:"月收入"}),F:h.work,G:e.o((e=>h.work=e.detail.value)),H:e.p({name:"work",label:"职业"}),I:e.o(c),J:e.p({placeholder:"请选择地址","popup-title":"请选择城市",collection:"opendb-city-china",field:"code as value, name as text",orderby:"value asc","step-searh":!0,"self-field":"code","parent-field":"parent_code"}),K:e.p({label:"所在城市",name:"city"}),L:h.phone,M:e.o((e=>h.phone=e.detail.value)),N:e.p({name:"phone",label:"手机号"}),O:h.wxCode,P:e.o((e=>h.wxCode=e.detail.value)),Q:e.p({name:"wxCode",label:"微信号"}),R:h.sincerity,S:e.o((e=>h.sincerity=e.detail.value)),T:e.p({name:"sincerity"}),U:e.o(C),V:e.sr(_,"5bba2867-0",{k:"form"}),W:e.p({model:h,"label-width":100,rules:i})})}});var t=e._export_sfc(a,[["__scopeId","data-v-5bba2867"]]);wx.createPage(t);
