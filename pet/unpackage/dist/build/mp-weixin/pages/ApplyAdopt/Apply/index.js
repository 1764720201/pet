"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+a+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const a=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",t=e.defineComponent({__name:"index",setup(a){const t=e.ref(5),n=e.ref(0),o=e.ref(2),r=e.reactive({phone:{rules:[{required:!0,errorMessage:"手机号不能为空"},{pattern:"^\\+?[0-9-]{3,20}$",errorMessage:"请输入正确的手机号"}]},city:{rules:[{required:!0,errorMessage:"请选择所在的城市"}]},work:{rules:[{required:!0,errorMessage:"请输入职业"}]},wxCode:{rules:[{required:!0,errorMessage:"请输入微信号"}]}}),i=e=>{t.value=e.detail.value,g.age=x[e.detail.value]},d=e=>{n.value=e.detail.value,g.house=m[e.detail.value]},l=e=>{o.value=e.detail.value,g.income=v[e.detail.value]},s=e.reactive([{value:0,text:"女铲屎官"},{value:1,text:"男铲屎官"}]),c=e.reactive([{value:0,text:"有"},{value:1,text:"无"}]),u=e.reactive([{value:0,text:"有猫"},{value:1,text:"有狗"},{value:2,text:"猫狗"},{value:3,text:"无"}]),p=e.reactive([{value:0,text:"单身"},{value:1,text:"恋爱"},{value:2,text:"已婚"}]),x=["40后","50后","60后","70后","80后","90后","00后","10后"],m=["自有住房","整租","合租","其他"],v=["小于3千","3-6千","6千-1万","一万以上"],g=e.reactive({adoptId:"",age:x[t.value],genderIndex:0,experienceIndex:0,presentIndex:0,house:m[n.value],marriageIndex:0,income:v[o.value],work:"",city:["浙江省","宁波市","宁海县"],phone:"",wxCode:"",sincerity:"",state:""}),h=e.pn.database(),I=e.ref(!1),y=s.map((e=>e.text)),w=e=>{g.city=e.data},f=c.map((e=>e.text)),k=p.map((e=>e.text)),_=u.map((e=>e.text)),b=e.pn.getCurrentUserInfo().uid;e.onLoad((async e=>{g.adoptId=e.adoptId,await h.collection("apply").where(`adopt_id=='${g.adoptId}'&&user_id=='${b}'&&state=='申请中'`).get().then((e=>{e.result.data[0]?I.value=!0:I.value=!1})).then((()=>{I.value&&h.collection("apply").where(`adopt_id=='${g.adoptId}'&&user_id=='${b}'`).get().then((e=>{const a=e.result.data[0];g.sincerity=a.sincerity,g.work=a.work,g.phone=a.phone,t.value=x.indexOf(a.age),n.value=m.indexOf(a.house),o.value=v.indexOf(a.income),g.wxCode=a.wx_code,g.genderIndex=y.indexOf(a.gender),g.city=a.city,g.experienceIndex=f.indexOf(a.experience),g.marriageIndex=k.indexOf(a.marriage),g.presentIndex=_.indexOf(a.present)}))}))}));const C=e.ref(null),j=async()=>{I.value?C.value.validate().then((()=>{h.collection("apply").where(`adopt_id=='${g.adoptId}'&&user_id=='${b}'`).update({adopt_id:g.adoptId,age:g.age,gender:s[g.genderIndex].text,experience:c[g.experienceIndex].text,present:u[g.presentIndex].text,house:g.house,marriage:p[g.marriageIndex].text,income:g.income,work:g.work,city:g.city,phone:g.phone,wx_code:g.wxCode,sincerity:g.sincerity,state:"申请中"})})).then((()=>{e.index.showToast({title:"编辑成功",icon:"none",success(){setTimeout((()=>{e.index.navigateBack()}),500)}})})):await C.value.validate().then((()=>{e.pn.callFunction({name:"apply",data:{adoptId:g.adoptId,age:g.age,gender:s[g.genderIndex].text,experience:c[g.experienceIndex].text,present:u[g.presentIndex].text,house:g.house,marriage:p[g.marriageIndex].text,income:g.income,work:g.work,city:g.city,phone:g.phone,wxCode:g.wxCode,sincerity:g.sincerity,state:"申请中"},success(){setTimeout((()=>{e.index.redirectTo({url:"/pages/Mine/Request/Apply/index",success(){e.index.showToast({title:"申请成功"})}})}),300)},fail(e){console.log(e)}})})).catch((e=>{console.log(e)}))};return(a,h)=>({a:e.o((e=>g.genderIndex=e)),b:e.p({mode:"tag",localdata:s,modelValue:g.genderIndex}),c:e.p({name:"genderIndex",label:"性别"}),d:e.t(x[t.value]),e:e.p({type:"right",size:"23",color:"#ccc"}),f:e.o(i),g:t.value,h:x,i:e.p({name:"age",label:"年龄"}),j:e.o((e=>g.experienceIndex=e)),k:e.p({mode:"tag",localdata:c,modelValue:g.experienceIndex}),l:e.p({name:"experienceIndex",label:"养宠经验"}),m:e.o((e=>g.presentIndex=e)),n:e.p({mode:"tag",localdata:u,modelValue:g.presentIndex}),o:e.p({name:"presentIndex",label:"目前宠物"}),p:e.t(m[n.value]),q:e.p({type:"right",size:"23",color:"#ccc"}),r:e.o(d),s:n.value,t:m,v:e.p({name:"house",label:"住房情况"}),w:e.o((e=>g.marriageIndex=e)),x:e.p({mode:"tag",localdata:p,modelValue:g.marriageIndex}),y:e.p({name:"marriageIndex",label:"婚姻状况"}),z:e.t(v[o.value]),A:e.p({type:"right",size:"23",color:"#ccc"}),B:e.o(l),C:o.value,D:v,E:e.p({name:"income",label:"月收入"}),F:g.work,G:e.o((e=>g.work=e.detail.value)),H:e.p({name:"work",label:"职业"}),I:e.t(g.city.join("")),J:e.o(w),K:e.p({type:"right",size:"20"}),L:e.p({label:"所在城市",name:"city"}),M:g.phone,N:e.o((e=>g.phone=e.detail.value)),O:e.p({name:"phone",label:"手机号"}),P:g.wxCode,Q:e.o((e=>g.wxCode=e.detail.value)),R:e.p({name:"wxCode",label:"微信号"}),S:g.sincerity,T:e.o((e=>g.sincerity=e.detail.value)),U:e.p({name:"sincerity"}),V:e.o(j),W:e.sr(C,"9155a39e-0",{k:"form"}),X:e.p({model:g,"label-width":100,rules:r})})}});var n=e._export_sfc(t,[["__scopeId","data-v-9155a39e"]]);wx.createPage(n);
