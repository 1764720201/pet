"use strict";var e=require("../../../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const o=e.defineComponent({__name:"index",props:{petInfo:null},setup(o){var n;const t=o,i=e.getCurrentInstance();null==(n=null==i?void 0:i.proxy)||n.$Bus.on("ifCollect",(e=>{u.value=e}));const l=()=>{e.index.pageScrollTo({scrollTop:1300,duration:300})},a=e.reactive({uid:""}),u=e.ref(),{petInfo:d}=e.toRefs(t);e.watch((()=>d.value._id),(e=>{d.value._id=e,r.collection("collect").where(`user_id=='${a.uid}'&&adopt_id=='${d.value._id}'`).get().then((e=>{var o;(null==(o=e.result.data[0])?void 0:o._id)?u.value=!0:u.value=!1}))})),e.onShow((()=>{Object.assign(a,e.pn.getCurrentUserInfo())})),e.onLoad((()=>{Object.assign(a,e.pn.getCurrentUserInfo())}));const r=e.pn.database(),s=()=>{var o;a.uid?(null==(o=null==i?void 0:i.proxy)||o.$Bus.emit("ifCollect2",!u.value),u.value?r.collection("collect").where(`user_id=='${a.uid}'&&adopt_id=='${d.value._id}'`).remove().then((()=>{u.value=!1,e.index.showToast({title:"取消收藏",icon:"none"})})):e.pn.callFunction({name:"collect",data:{userId:a.uid,adoptId:d.value._id,type:0}}).then((()=>{u.value=!0,e.index.showToast({title:"收藏成功",icon:"none"})}))):e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})},c=()=>{d.value.if_adopt?e.index.showToast({title:"已被领养",icon:"error"}):d.value.user_id==a.uid?e.index.showToast({title:"你不能领养自己的宠物",icon:"none"}):e.index.navigateTo({url:`./Apply/index?adoptId=${d.value._id}`})};return(o,n)=>({a:e.p({type:"chatboxes",size:25}),b:e.o(l),c:e.o(c),d:e.p({type:"star",size:25,color:u.value?"#d78797":"#ccc"}),e:e.o(s)})}});wx.createComponent(o);
