"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-data-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const a=e.defineComponent({__name:"index",setup(a){const t=e.reactive({uid:0});e.onShow((()=>{Object.assign(t,e.pn.getCurrentUserInfo())})),e.onLoad((()=>{Object.assign(t,e.pn.getCurrentUserInfo()),t.uid||e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})}));const n=e.reactive({city:[],name:"",introduce:"",title:"",uploadPicture:[],wxCode:"",phone:"",authorName:"",reward:"",typeIndex:0,starIndex:0,genderIndex:0,variety:"",avatarURL:""}),r=e.reactive({title:{rules:[{required:!0,errorMessage:"标题不能为空"}]},uploadPicture:{rules:[{required:!0,errorMessage:"图片不能为空"}]},name:{rules:[{required:!0,errorMessage:"姓名不能为空"}]},wxCode:{rules:[{required:!0,errorMessage:"微信号不能为空"}]},introduce:{rules:[{required:!0,errorMessage:"介绍不能为空"},{maxLength:200,errorMessage:"最大长度为200"}]},phone:{rules:[{required:!0,errorMessage:"手机号不能为空"},{format:"number",errorMessage:"手机号必须为数字"}]}}),o=e.ref(null),i=e=>{n.city.push(e.detail.value[0].text),n.city.push(e.detail.value[1].text),n.city.push(e.detail.value[2].text)},l=e.pn.database(),u=async()=>{await l.collection("uni-id-users").where(`_id=='${t.uid}'`).field("avatar_file,nickname").get().then((e=>{n.avatarURL=e.result.data[0].avatar_file.url,n.authorName=e.result.data[0].nickname})).then((()=>{o.value.validate().then((()=>{e.pn.callFunction({name:"foundPet",data:{type:d[n.typeIndex].text,imageList:n.uploadPicture,name:n.name,star:s[n.starIndex].text,variety:n.variety,gender:c[n.genderIndex].text,introduce:n.introduce,title:n.title,city:n.city,phone:n.phone,wxCode:n.wxCode,reward:n.reward,avatarURL:n.avatarURL,authorName:n.authorName,state:"已发布"},success(){e.index.showToast({title:"发布成功"})},fail(e){console.log(e)}})}))})).then((()=>{e.index.navigateBack()})).catch((e=>{console.log(e)}))},d=e.reactive([{text:"寻宠",value:0},{text:"寻主",value:1}]),s=e.reactive([{text:"汪星人",value:0},{text:"喵星人",value:1},{text:"其他",value:2}]),c=e.reactive([{text:"男生",value:0},{text:"女生",value:1}]);return(a,t)=>({a:n.title,b:e.o((e=>n.title=e.detail.value)),c:e.p({name:"title"}),d:e.o((e=>n.introduce=e)),e:e.p({type:"textarea",cols:"40",rows:"5",placeholder:"宝贝特征介绍~",modelValue:n.introduce}),f:e.p({name:"introduce"}),g:e.o((e=>n.uploadPicture=e)),h:e.p({limit:"3","file-mediatype":"image",modelValue:n.uploadPicture}),i:e.p({name:"uploadPicture"}),j:e.o((e=>n.typeIndex=e)),k:e.p({mode:"tag",localdata:d,modelValue:n.typeIndex}),l:e.p({label:"类型",name:"type"}),m:n.variety,n:e.o((e=>n.variety=e.detail.value)),o:e.p({label:"品种",name:"variety"}),p:n.name,q:e.o((e=>n.name=e.detail.value)),r:e.p({label:"姓名",name:"name"}),s:n.phone,t:e.o((e=>n.phone=e.detail.value)),v:e.p({label:"电话",name:"phone"}),w:n.wxCode,x:e.o((e=>n.wxCode=e.detail.value)),y:e.p({label:"微信号",name:"wxCode"}),z:e.o(i),A:e.p({placeholder:"请选择地址","popup-title":"请选择城市",collection:"opendb-city-china",field:"code as value, name as text",orderby:"value asc","step-searh":!0,"self-field":"code","parent-field":"parent_code"}),B:e.p({label:"走失城市",name:"city"}),C:e.o((e=>n.starIndex=e)),D:e.p({mode:"tag",localdata:s,modelValue:n.starIndex}),E:e.p({label:"丢了什么",name:"star"}),F:e.o((e=>n.genderIndex=e)),G:e.p({mode:"tag",localdata:c,modelValue:n.genderIndex}),H:e.p({label:"性别",name:"gender"}),I:n.reward,J:e.o((e=>n.reward=e.detail.value)),K:e.p({label:"悬赏金额",name:"reward"}),L:e.sr(o,"5880462c-0",{k:"form"}),M:e.p({modelValue:n,"label-width":"150",rules:r}),N:e.o(u)})}});var t=e._export_sfc(a,[["__scopeId","data-v-5880462c"]]);wx.createPage(t);
