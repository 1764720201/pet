"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+t+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const t=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",a=e.defineComponent({__name:"index",setup(t){const a=e.reactive({uid:0}),n=e=>{o.city=e.data};e.onShow((()=>{Object.assign(a,e.pn.getCurrentUserInfo())}));const r=e.ref(),i=e.ref();e.onLoad((t=>{t.id?(r.value=!0,i.value=t.id):r.value=!1,Object.assign(a,e.pn.getCurrentUserInfo()),a.uid?r.value&&l.collection("foundPet").where(`_id=='${i.value}'&&user_id=='${a.uid}'`).get({getOne:!0}).then((e=>{const t=e.result.data;o.city=t.city,o.title=t.title,o.introduce=t.introduce,o.uploadPicture=t.uploadPicture,o.variety=t.variety,o.name=t.name,o.phone=t.phone,o.wxCode=t.wx_code,o.reward=t.reward,o.typeIndex=x[0].indexOf(t.type),o.starIndex=x[1].indexOf(t.star),o.genderIndex=x[2].indexOf(t.gender)})):e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})}));const o=e.reactive({city:["浙江省","宁波市","宁海县"],name:"",introduce:"",title:"",uploadPicture:[],wxCode:"",phone:"",authorName:"",reward:"",typeIndex:0,starIndex:0,genderIndex:0,variety:"",avatarURL:""}),d=e.reactive({title:{rules:[{required:!0,errorMessage:"标题不能为空"}]},uploadPicture:{rules:[{required:!0,errorMessage:"图片不能为空"}]},name:{rules:[{required:!0,errorMessage:"姓名不能为空"}]},wxCode:{rules:[{required:!0,errorMessage:"微信号不能为空"}]},introduce:{rules:[{required:!0,errorMessage:"介绍不能为空"},{maxLength:200,errorMessage:"最大长度为200"}]},phone:{rules:[{required:!0,errorMessage:"手机号不能为空"},{format:"number",errorMessage:"手机号必须为数字"}]}}),u=e.ref(null),l=e.pn.database(),s=async()=>{r.value?l.collection("foundPet").where(`_id=='${i.value}'&&user_id=='${a.uid}'`).update({type:c[o.typeIndex].text,uploadPicture:o.uploadPicture,name:o.name,star:p[o.starIndex].text,variety:o.variety,gender:m[o.genderIndex].text,introduce:o.introduce,title:o.title,city:o.city,phone:o.phone,wx_code:o.wxCode,reward:o.reward}).then((()=>{e.index.showToast({title:"修改成功",icon:"none",success(){setTimeout((()=>{e.index.navigateBack()}),500)}})})):await l.collection("uni-id-users").where(`_id=='${a.uid}'`).field("avatar_file,nickname").get().then((e=>{o.avatarURL=e.result.data[0].avatar_file.url,o.authorName=e.result.data[0].nickname})).then((()=>{u.value.validate().then((()=>{e.pn.callFunction({name:"foundPet",data:{type:c[o.typeIndex].text,imageList:o.uploadPicture,name:o.name,star:p[o.starIndex].text,variety:o.variety,gender:m[o.genderIndex].text,introduce:o.introduce,title:o.title,city:o.city,phone:o.phone,wxCode:o.wxCode,reward:o.reward,avatarURL:o.avatarURL,authorName:o.authorName,state:"已发布"},success(){e.index.showToast({title:"发布成功"})},fail(e){console.log(e)}})}))})).then((()=>{e.index.navigateBack()})).catch((e=>{console.log(e)}))},c=e.reactive([{text:"寻宠",value:0},{text:"寻主",value:1}]),p=e.reactive([{text:"汪星人",value:0},{text:"喵星人",value:1},{text:"其他",value:2}]),m=e.reactive([{text:"男生",value:0},{text:"女生",value:1}]),x=[c,p,m].map((e=>e.map((e=>e.text))));return(t,a)=>({a:o.title,b:e.o((e=>o.title=e.detail.value)),c:e.p({name:"title"}),d:e.o((e=>o.introduce=e)),e:e.p({type:"textarea",cols:"40",rows:"5",placeholder:"宝贝特征介绍~",modelValue:o.introduce}),f:e.p({name:"introduce"}),g:e.o((e=>o.uploadPicture=e)),h:e.p({limit:"3","file-mediatype":"image",modelValue:o.uploadPicture}),i:e.p({name:"uploadPicture"}),j:e.o((e=>o.typeIndex=e)),k:e.p({mode:"tag",localdata:c,modelValue:o.typeIndex}),l:e.p({label:"类型",name:"type"}),m:o.variety,n:e.o((e=>o.variety=e.detail.value)),o:e.p({label:"品种",name:"variety"}),p:o.name,q:e.o((e=>o.name=e.detail.value)),r:e.p({label:"姓名",name:"name"}),s:o.phone,t:e.o((e=>o.phone=e.detail.value)),v:e.p({label:"电话",name:"phone"}),w:o.wxCode,x:e.o((e=>o.wxCode=e.detail.value)),y:e.p({label:"微信号",name:"wxCode"}),z:e.t(o.city.join("")),A:e.o(n),B:e.p({type:"right",size:"20"}),C:e.p({label:"走失城市",name:"city"}),D:e.o((e=>o.starIndex=e)),E:e.p({mode:"tag",localdata:p,modelValue:o.starIndex}),F:e.p({label:"丢了什么",name:"star"}),G:e.o((e=>o.genderIndex=e)),H:e.p({mode:"tag",localdata:m,modelValue:o.genderIndex}),I:e.p({label:"性别",name:"gender"}),J:o.reward,K:e.o((e=>o.reward=e.detail.value)),L:e.p({label:"悬赏金额",name:"reward"}),M:e.sr(u,"f731aa58-0",{k:"form"}),N:e.p({modelValue:o,"label-width":"150",rules:d}),O:e.o(s)})}});var n=e._export_sfc(a,[["__scopeId","data-v-f731aa58"]]);wx.createPage(n);
