"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+t+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const t=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",a=e.defineComponent({__name:"index",setup(t){const a=e=>{s.city=e.data},r=e.reactive({uid:0}),l=e.pn.database();e.onShow((()=>{Object.assign(r,e.pn.getCurrentUserInfo())}));const o=e.ref(),u=e.ref();e.onLoad((t=>{t.id?(o.value=!0,u.value=t.id):o.value=!1,Object.assign(r,e.pn.getCurrentUserInfo()),r.uid?(l.collection("uni-id-users").where(`_id=='${r.uid}'`).field("nickname").get().then((e=>{s.name=e.result.data[0].nickname})),o.value&&l.collection("adoption").where(`_id=='${u.value}'&&user_id=='${r.uid}'`).get({getOne:!0}).then((e=>{const t=e.result.data;s.uploadPicture=t.img,s.video=t.video,s.city=t.city,s.phone=t.phone,s.wxCode=t.wx_code,s.variety=t.variety,s.petName=t.pet_name,s.story=t.story,s.starIndex=f[5].indexOf(t.star),s.genderIndex=f[4].indexOf(t.gender),s.punchIndex=f[0].indexOf(t.punch),s.age=f[2].indexOf(t.age),s.medical=i(t.medical,1),s.source=i(t.source,3),s.request=i(t.request,6),s.particular=i(t.particular,7)}))):e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})}));const i=(e,t)=>e.map((e=>f[t].indexOf(e))),n=e.ref(null),d=e.reactive({petName:{rules:[{required:!0,errorMessage:"宠物名不能为空"},{maxLength:5,errorMessage:"宠物名最多5个字"}]},name:{rules:[{required:!0,errorMessage:"姓名不能为空"}]},wxCode:{rules:[{required:!0,errorMessage:"微信号不能为空"}]},request:{rules:[{required:!0,errorMessage:"领养要求不能为空"}]},source:{rules:[{required:!0,errorMessage:"来源不能为空"}]},medical:{rules:[{required:!0,errorMessage:"医疗不能为空"}]},uploadPicture:{rules:[{required:!0,errorMessage:"图片不能为空"}]},stroy:{rules:[{required:!0,errorMessage:"领养要求不能为空"},{maxLength:200,errorMessage:"字数最多200"}]},variety:{rules:[{required:!0,errorMessage:"品种不能为空"}]},age:{rules:[{required:!0,errorMessage:"年龄不能为空"}]},city:{rules:[{required:!0,errorMessage:"城市不能为空"}]},phone:{rules:[{required:!0,errorMessage:"手机号不能为空"},{format:"number",errorMessage:"手机号必须为数字"}]}}),s=e.reactive({story:"",name:"",variety:"",phone:"",city:["浙江省","宁波市","宁海县"],petName:"",genderIndex:0,punchIndex:0,age:null,wxCode:"",uploadPicture:[],medical:[],source:[],request:[],particular:[],starIndex:1,video:[]}),c=e.reactive([{text:"汪星人",value:0},{text:"喵星人",value:1},{text:"其他",value:2}]),m=e.reactive([{text:"男生",value:0},{text:"女生",value:1}]),p=e.reactive([{text:"已绝育",value:0},{text:"已免疫",value:1},{text:"已驱虫",value:2}]),x=e.reactive([{text:"家养",value:0},{text:"个人求助",value:1},{text:"流浪基地",value:2}]),v=e.reactive([{text:"不满1个月",value:0},{text:"1个月",value:1},{text:"2个月",value:2},{text:"3-6个月",value:3},{text:"6个月-1岁",value:4},{text:"1岁",value:5},{text:"2岁",value:6},{text:"3岁及以上",value:7}]),g=e.reactive([{text:"高冷",value:0},{text:"粘人",value:1},{text:"铁憨憨",value:2},{text:"甜美",value:3},{text:"温文尔雅",value:4},{text:"乖巧",value:5},{text:"贪玩",value:6},{text:"胆小",value:7},{text:"叛逆",value:8},{text:"懒惰",value:9},{text:"无攻击性",value:10},{text:"不挑食",value:11},{text:"不乱叫",value:12},{text:"讲卫生",value:13}]),h=e.reactive([{text:"仅限同城",value:0},{text:"接受回访",value:1},{text:"签订协议",value:2},{text:"绝育",value:3},{text:"安装纱窗",value:4},{text:"办理狗证",value:5},{text:"出门牵绳",value:6}]),y=e.reactive([{text:"不需要打卡",value:0},{text:"4周",value:1},{text:"5周",value:2},{text:"8周",value:3},{text:"12周",value:4},{text:"16周",value:5}]),f=[y,p,v,x,m,c,h,g].map((e=>e.map((e=>e.text)))),q=(e,t)=>e.map((e=>t[e].text)),_=()=>{const t=q(s.medical,p),a=q(s.source,x),i=q(s.particular,g),d=q(s.request,h);o.value?l.collection("adoption").where(`_id=='${u.value}'&&user_id=='${r.uid}'`).update({img:s.uploadPicture,pet_name:s.petName,star:c[s.starIndex].text,variety:s.variety,gender:m[s.genderIndex].text,age:v[s.age].text,medical:t,source:a,particular:i,story:s.story,request:d,punch:y[s.punchIndex].text,name:s.name,city:s.city,phone:s.phone,wx_code:s.wxCode}).then((()=>{e.index.showToast({title:"修改成功",icon:"none",success(){setTimeout((()=>{e.index.navigateBack()}),500)}})})).catch((e=>{console.log(e)})):n.value.validate().then((()=>{e.pn.callFunction({name:"adoption",data:{user_id:r.uid,imageList:s.uploadPicture,petName:s.petName,star:c[s.starIndex].text,variety:s.variety,gender:m[s.genderIndex].text,age:v[s.age].text,medicalList:t,source:a,particularList:i,story:s.story,requestList:d,punch:y[s.punchIndex].text,name:s.name,city:s.city,phone:s.phone,wx_code:s.wxCode,video:s.video,ifAdopt:!1},success(){e.index.showToast({title:"发布成功"})},fail(e){console.log(e)}})})).then((()=>{e.index.navigateBack()})).catch((e=>{console.log(e)}))};return(t,r)=>({a:e.o((e=>s.uploadPicture=e)),b:e.p({limit:"3","file-mediatype":"image",modelValue:s.uploadPicture}),c:e.p({name:"uploadPicture"}),d:e.o((e=>s.video=e)),e:e.p({limit:"1","file-mediatype":"video",modelValue:s.video}),f:s.petName,g:e.o((e=>s.petName=e.detail.value)),h:e.p({label:"宠物昵称",name:"petName"}),i:e.o((e=>s.starIndex=e)),j:e.p({mode:"tag",localdata:c,modelValue:s.starIndex}),k:e.p({label:"星球",name:"star"}),l:s.variety,m:e.o((e=>s.variety=e.detail.value)),n:e.p({label:"品种",name:"variety"}),o:e.o((e=>s.genderIndex=e)),p:e.p({mode:"tag",localdata:m,modelValue:s.genderIndex}),q:e.p({label:"性别",name:"gender"}),r:e.o((e=>s.age=e)),s:e.p({localdata:v,modelValue:s.age}),t:e.p({label:"年龄",name:"age"}),v:e.o((e=>s.medical=e)),w:e.p({mode:"tag",multiple:!0,localdata:p,modelValue:s.medical}),x:e.p({label:"医疗",name:"medical"}),y:e.o((e=>s.source=e)),z:e.p({mode:"tag",multiple:!0,localdata:x,modelValue:s.source}),A:e.p({label:"宠物来源",name:"source"}),B:e.o((e=>s.particular=e)),C:e.p({mode:"tag",multiple:!0,localdata:g,max:"3",modelValue:s.particular}),D:e.p({name:"particular"}),E:s.story,F:e.o((e=>s.story=e.detail.value)),G:e.p({name:"story"}),H:e.o((e=>s.request=e)),I:e.p({mode:"tag",multiple:!0,localdata:h,modelValue:s.request}),J:e.p({name:"request"}),K:e.o((e=>s.punchIndex=e)),L:e.p({localdata:y,clear:!1,modelValue:s.punchIndex}),M:e.p({label:"送养成功后,要求领养人打卡",name:"punch"}),N:s.name,O:e.o((e=>s.name=e.detail.value)),P:e.p({label:"姓名",name:"name"}),Q:e.t(s.city.join("")),R:e.o(a),S:e.p({type:"right",size:"20"}),T:e.p({label:"所在城市",name:"city"}),U:s.phone,V:e.o((e=>s.phone=e.detail.value)),W:e.p({label:"手机号",name:"phone"}),X:s.wxCode,Y:e.o((e=>s.wxCode=e.detail.value)),Z:e.p({label:"微信号",name:"wxCode"}),aa:e.sr(n,"3468dd06-0",{k:"form"}),ab:e.p({rules:d,"label-width":"150",modelValue:s}),ac:e.o(_)})}});var r=e._export_sfc(a,[["__scopeId","data-v-3468dd06"]]);wx.createPage(r);
