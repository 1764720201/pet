"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("tui-icon")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../node-modules/thorui-uni/lib/thorui/tui-icon/tui-icon.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const t=e.defineComponent({__name:"index",props:{orderby:null},setup(t){const o=t,{orderby:a}=e.toRefs(o),l=e.pn.getCurrentUserInfo().uid,i=e.ref(3),n=e.ref(),c=e.ref(!0);e.onReachBottom((()=>{i.value+=3,c.value=!0,r(),i.value>n.value&&(c.value=!1)}));const u=e.ref([]),r=()=>{s.collection(m,"comment","uni-id-users","collect").limit(i.value).get({getCount:!0}).then((e=>{n.value=e.result.count,u.value=e.result.data}))};e.onShow((()=>{r(),_()}));const d=e.ref(),s=e.pn.database(),m=s.collection("topic").orderBy(a.value,"desc").getTemp(),p=e.ref([]),v=s.collection("uni-id-users").where(`_id=='${l}'`).field("_id").getTemp(),_=()=>{s.collection(v,"collect").field("_id.collect as collect").get({getOne:!0}).then((e=>{p.value=e.result.data.collect.filter((e=>4==e.type&&e.user_id==l)).map((e=>e.topic_id))}))},f=e.ref(),h=t=>{e.index.navigateTo({url:`/pages/Home/Daily/CatDaily/TopicDetail/index?id=${t}`,async success(){await s.collection("topic").where(`_id=='${t}'`).field("read").get({getOne:!0}).then((e=>{d.value=e.result.data.read})),s.collection("topic").where(`_id=='${t}'`).update({read:d.value+1})},fail(e){console.log(e)}})};return(t,o)=>e.e({a:e.f(u.value,((t,o,a)=>({a:t.user_id[0].avatar_file.url,b:e.t(t.user_id[0].nickname),c:"027f11b4-0-"+a,d:e.p({date:t.create_time,format:"MM-dd hh:mm"}),e:e.t(t.content),f:e.o((e=>h(t._id._value))),g:e.f(t.image,((e,t,o)=>({a:e.path,b:t}))),h:e.o((e=>h(t._id._value))),i:"027f11b4-1-"+a,j:e.p({name:"agree",size:"23",color:p.value.includes(t._id._value)?"#ec9312":"#ccc"}),k:e.t(t._id.collect.length),l:e.o((o=>(async t=>{const o=async()=>{await s.collection("collect").where(`topic_id=='${t}'&&user_id=='${l}'`).get({getOne:!0}).then((e=>{e.result.data?f.value=!0:f.value=!1}))};o().then((()=>{f.value?s.collection("collect").where(`topic_id=='${t}'&&user_id=='${l}'`).remove().then((()=>{_(),r(),o()})):e.pn.callFunction({name:"collect",data:{type:4,topicId:t,userId:l},success(){e.index.showToast({title:"点赞成功"}),_(),r(),o()},fail(e){console.log(e)}})}))})(t._id._value))),m:"027f11b4-2-"+a,n:e.t(t._id.comment.length),o:t.create_time}))),b:e.p({name:"message",size:"25"}),c:c.value},c.value?{d:e.p({status:"loading"})}:{},{e:!c.value},c.value?{}:{f:e.p({status:"noMore"})})}});var o=e._export_sfc(t,[["__scopeId","data-v-027f11b4"]]);wx.createComponent(o);
