"use strict";var e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-dateformat")+e.resolveComponent("unicloud-db")+e.resolveComponent("uni-load-more")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o=e.defineComponent({__name:"index",props:{state:null},setup(o){const n=o,{state:t}=e.toRefs(n),a=e.ref(null),i=e.pn.getCurrentUserInfo().uid,l=e.pn.database();let u=e.reactive([]);const d=e.ref(null),r=e.ref(null),p=e.ref(null),s=e.ref(),c=e.ref(),f=()=>{l.collection("apply").where(`_id=='${s.value}'`).update({state:"送养成功"}).then((()=>{l.collection("adoption").where(`_id=='${c.value}'`).update({if_adopt:!0})})).then((()=>{a.value.refresh(),e.index.showToast({title:"已成功送养"})}))},v=()=>{l.collection("apply").where(`_id=='${s.value}'`).update({state:"已拒绝"}).then((()=>{a.value.refresh(),e.index.showToast({title:"已成功拒绝"})}))},m=()=>{l.collection("apply").where(`_id=='${s.value}'`).update({state:"已取消"}).then((()=>{a.value.refresh(),e.index.showToast({title:"已成功取消"})}))};return e.watch((()=>t.value),(e=>{t.value=e,u=[l.collection("adoption").where(`user_id=='${i}'`).field("_id,img,pet_name,issue_time").getTemp(),l.collection("apply").where(`state=='${t.value}'`).getTemp()]}),{immediate:!0}),(o,n)=>({a:e.w((({data:o,pagination:n,loading:a,error:i,hasMore:l},u,f)=>e.e({a:i},i?{b:e.t(i.message)}:e.e({c:e.f(o,((o,n,a)=>{var i,l,u;return e.e({a:null==(i=null==o?void 0:o._id)?void 0:i.apply},(null==(l=null==o?void 0:o._id)?void 0:l.apply)?{b:e.f(null==(u=null==o?void 0:o._id)?void 0:u.apply,((o,n,i)=>e.e("申请中"==e.unref(t)?{a:e.o((e=>{return n=o._id,t=o.adopt_id,s.value=n,c.value=t,void p.value.open("center");var n,t})),b:"36a512fe-1-"+f+"-"+a+"-"+i+",36a512fe-0",c:e.p({type:"trash",size:"25",color:"#777"})}:{},{d:"36a512fe-2-"+f+"-"+a+"-"+i+",36a512fe-0",e:e.w((({data:o,loading:n,error:t,options:a},i,l)=>({a:null==o?void 0:o.avatar_file.url,b:e.t(null==o?void 0:o.nickname),c:l,d:i})),{name:"d",path:"a["+f+"].c["+a+"].b["+i+"].e",vueId:"36a512fe-3-"+f+"-"+a+"-"+i+",36a512fe-0"}),f:e.t(null==o?void 0:o.city[0]),g:e.t(null==o?void 0:o.city[1]),h:e.t(null==o?void 0:o.city[2]),i:e.t(o.sincerity),j:"36a512fe-3-"+f+"-"+a+"-"+i+",36a512fe-0",k:e.p({collection:"uni-id-users",getone:!0,field:"avatar_file,nickname",where:`_id=='${o.user_id}'`}),l:"36a512fe-4-"+f+"-"+a+"-"+i+",36a512fe-0",m:e.o((n=>{return t=o._id,void e.index.navigateTo({url:`/pages/Mine/Request/Receive/ProposerDetail/index?applyId=${t}`});var t}))},"申请中"==e.unref(t)?{n:e.o((e=>{return n=o._id,t=o.adopt_id,s.value=n,c.value=t,void d.value.open("center");var n,t}))}:{},"申请中"==e.unref(t)?{o:e.o((e=>{return n=o._id,t=o.adopt_id,s.value=n,c.value=t,void r.value.open("center");var n,t}))}:{},{p:o._id}))),c:o.img[0].url,d:e.t(o.pet_name),e:"申请中"==e.unref(t),f:e.p({date:o.issue_time,format:"yyyy-MM-dd hh:mm:ss"}),g:e.p({type:"chat",size:"30",color:"white"}),h:"申请中"==e.unref(t),i:"申请中"==e.unref(t)}:{},{j:null==o?void 0:o._id._value})})),d:a},a?{e:"36a512fe-5-"+f+",36a512fe-0",f:e.p({status:"loading"})}:{},{g:l&&!a},l&&!a?{h:"36a512fe-6-"+f+",36a512fe-0",i:e.p({status:"more"})}:l||a?{}:{k:"36a512fe-7-"+f+",36a512fe-0",l:e.p({status:"noMore"})},{j:!l&&!a}),{m:f,n:u})),{name:"d",path:"a",vueId:"36a512fe-0"}),b:e.sr(a,"36a512fe-0",{k:"udb"}),c:e.p({collection:e.unref(u),orderby:"issue_time desc",getone:!1,"page-size":25}),d:e.o(f),e:e.p({type:"warning",cancelText:"取消",confirmText:"同意",title:"同意",content:"你确定要将该宠物送给申请人吗"}),f:e.sr(d,"36a512fe-8",{k:"allow"}),g:e.p({type:"dialog"}),h:e.o(v),i:e.p({type:"warning",cancelText:"关闭",confirmText:"拒绝",title:"拒绝",content:"你确定要拒绝该申请吗"}),j:e.sr(r,"36a512fe-10",{k:"refuse"}),k:e.p({type:"dialog"}),l:e.o(m),m:e.p({type:"warning",cancelText:"关闭",confirmText:"取消申请",title:"取消申请",content:"你确定要取消该申请吗"}),n:e.sr(p,"36a512fe-12",{k:"cancel"}),o:e.p({type:"dialog"})})}});var n=e._export_sfc(o,[["__scopeId","data-v-36a512fe"]]);wx.createComponent(n);
