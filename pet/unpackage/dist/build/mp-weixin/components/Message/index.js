"use strict";var e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("tui-icon")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../node-modules/thorui-uni/lib/thorui/tui-icon/tui-icon.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=e.defineComponent({__name:"index",props:{commentList:null,where:null},setup(n){const o=n,{commentList:t,where:a}=e.toRefs(o),d=e.ref(null),i=e.pn.getCurrentUserInfo().uid,m=e.reactive({commentId:"",commentUserId:"",commentNickname:"",adoptId:"",foundId:"",topicId:""}),c=e.pn.database(),u=e.reactive({avatar_file:{url:""},nickname:""}),p=e.ref([]);e.watch((()=>a.value),(e=>{a.value=e,r()}));const r=async()=>{await c.collection("comment").where(a.value).field("nickname,comment,comment_id").get().then((e=>{p.value=e.result.data}))};e.onLoad((async()=>{await c.collection("uni-id-users").where(`_id=='${i}'`).field("nickname,avatar_file").get({getOne:!0}).then((e=>{Object.assign(u,e.result.data)})).catch((e=>{console.log(e)}))}));const s=n=>{e.pn.callFunction({name:"comment",data:{comment:n,type:1,userId:i,adoptId:m.adoptId,nickname:u.nickname,avatarUrl:u.avatar_file.url,commentId:m.commentId,commentUserId:m.commentUserId,foundId:m.foundId,topicId:m.topicId},success(){r(),e.index.showToast({title:"回复成功",icon:"none"})},fail(e){console.log(e)}})};return(n,o)=>({a:e.f(e.unref(t),((n,o,t)=>e.e({a:n.avatar_url,b:e.t(n.nickname),c:"1e0aadd5-0-"+t,d:e.p({date:n.create_time,format:"yyyy-MM-dd hh:mm:ss"}),e:e.o((e=>{return o=n._id,t=n.user_id,a=n.nickname,i=n.adopt_id,c=n.found_id,u=n.topic_id,m.commentId=o,m.commentNickname=a,m.commentUserId=t,m.adoptId=i,m.foundId=c,m.topicId=u,void d.value.open("center");var o,t,a,i,c,u})),f:"1e0aadd5-1-"+t,g:e.t(n.comment)},p.value[0]?{h:e.f(p.value,((o,t,a)=>e.e({a:o.comment_id==n._id},o.comment_id==n._id?{b:e.t(o.nickname),c:e.t(o.comment)}:{},{d:o._id})))}:{},{i:n._id}))),b:e.p({name:"message"}),c:p.value[0],d:e.sr("inputClose","1e0aadd5-3,1e0aadd5-2"),e:e.o(s),f:e.p({title:"回复",mode:"input",placeholder:"@"+m.commentNickname}),g:e.sr(d,"1e0aadd5-2",{k:"inputDialog"}),h:e.p({type:"dialog"})})}});var o=e._export_sfc(n,[["__scopeId","data-v-1e0aadd5"]]);wx.createComponent(o);
