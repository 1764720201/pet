"use strict";var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,i=require("../../../../common/vendor.js"),l=require("./util.js");exports.CommonDrawMethods=class{constructor(t,e,r){this.Context=t,this.type=e,this.is2d="2d"===e,this.commonUtilMethods=r,this.drawParams={}}setAlpha(t=1){const{Context:e,is2d:r}=this;r?e.globalAlpha=t:e.setGlobalAlpha(t)}setFillStyle(t){const{Context:e,is2d:r}=this;r?e.fillStyle=t:e.setFillStyle(t)}setLineWidth(t){const{Context:e,is2d:r}=this;r?e.lineWidth=t:e.setLineWidth(t)}setStrokeStyle(t){const{Context:e,is2d:r}=this;r?e.strokeStyle=t:e.setStrokeStyle(t)}setShadow(t,e,r,n){const{Context:o,is2d:a}=this;o.shadowOffsetX=t,o.shadowOffsetY=e,o.shadowColor=n,o.shadowBlur=r}setRotate(t,e,r,n,o){const{Context:a}=this,{deg:s=0,type:i="middle"}=o;let l=t,h=e;switch(i){case"topLeft":a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"topMiddle":l=t+r/2,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"topRight":l=t+r,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"bottomLeft":h=e+n,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"bottomMiddle":l=t+r/2,h=e+n,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"bottomRight":l=t+r,h=e+n,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"middleLeft":h=e+n/2,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"middleRight":l=t+r,h=e+n/2,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h);break;case"middle":l=t+r/2,h=e+n/2,a.translate(l,h),a.rotate(s*Math.PI/180),a.translate(-l,-h)}}setTriangleRotate(t,e,r,n,o,a){const{Context:s}=this,{deg:i=0,type:l="middle"}=o;let h=t,d=e;switch(l){case"top":"right"==a?(h=t,d=e):(h=t+r/2,d=e),s.translate(h,d),s.rotate(i*Math.PI/180),s.translate(-h,-d);break;case"left":h=t,d=e+n,s.translate(h,d),s.rotate(i*Math.PI/180),s.translate(-h,-d);break;case"right":h=t+r,d=e+n,s.translate(h,d),s.rotate(i*Math.PI/180),s.translate(-h,-d);break;case"middle":h=t+r/2,d=e+n/2,s.translate(h,d),s.rotate(i*Math.PI/180),s.translate(-h,-d)}}computedCenterX(t,e,r="center",n=0){return"center"===r?(t-e)/2-n:"right"===r?t-e-n:0}computedFontTextLineHeight(t,e,r,n,o,a,s,h,d,c,u,x){const{Context:p,commonUtilMethods:g}=this,{canvasWidth:y,getConvertedValue:f,is2d:m}=g,{fontSize:b}=s;p.font=s.style;let{lineNum:w,lineHeight:C,lineStyle:P}=h,S=l.countTextLength(p,n,b);0!=r&&375.0001!=r||(r=S>y?y:S+b);let v=[];function M(t){let e="";const n=[],s=[];for(let i in t){e+=t[i];let h=l.countTextLength(p,e,b);if(0!=o&&0===n.length&&(h+=o),h>=r-b||i==t.length-1){const t=0==n.length?0:n[n.length-1].index,r=Object.assign([],s).splice(t,i),o=0!=a&&0!=r.length&&r.reverse().find((t=>t.length<=a));n.push({length:h,text:e,index:i-1,lastText:e.substring(0,e.length-1)+"...",limitText:o?o.text+"...":"",limitTextWidth:l.countTextLength(p,o.text+"...",b)}),e=""}s.push({index:i,text:e,length:h})}return n}if(n.includes("\n")){const t=n.split("\n");for(let e of t)v.push(...M(e))}else v=M(n);C=1==C?b+2:C;let I=v.length,T=-1!=w?w:I;T>I&&(T=I);let k=[];for(let l=0;l<T;l++){let{text:n,length:h,lastText:p,limitText:g,limitTextWidth:m}=v[l],S={},M=t,I=t;if(0==l&&0!=o&&"none"==d&&"none"==c&&(h+=o,M+=o,I=M),n&&-1!=w&&l==w-1&&(a>0?(n=g,h=m):n=h+b>=r?p:n),"none"!==d&&h<=r){let t=r;h==r&&(t=y),I=this.computedCenterX(t,h,d),M+=I}"none"!==c&&"none"!==d?(M=this.computedCenterX(y,r,c,x),M+=I,I=M):"none"!==c&&(M=this.computedCenterX(y,r,c,x),I=M);let T=0,L=e+l*C;"none"!==P&&(I+=f(0),T=h+f(0),"underline"==P?L+=b+1:"lineThrough"==P&&(L+=b/2,"android"===i.index.getSystemInfoSync().platform&&"2d"!==this.type&&(L+=s.fontSize/6))),S.w=h,S.text=n,S.x=M,0==C?(S.y=e+b*l,L+=b*l):S.y=e+C*l,S.fontColor=u,S.lineColor=u,S.tw=T,S.ty=L,S.tx=I,S.ey=S.y+b,n&&k.push(S)}return k}},exports.CommonUtilMethods=class{constructor(t){const{unit:e,type:r,width:n,height:o,fontStyle:a}=t;this.unit=e,this.type=r,this.is2d="2d"===r,this.width=n,this.height=o,this.fontStyle=a,this.Context=null,this.canvas=null}setCanvasStyle(){const{width:t,height:e}=this;this.canvasWidth=this.getConvertedValue(t),this.canvasHeight=this.getConvertedValue(e)}getConvertedValue(t=0){return 0===t?0:"px"===this.unit?t:375.0001===t?375.0001:i.index.upx2px(t)}pxToRpx(t=0){return t/(i.index.upx2px(100)/100)}rpxToPx(t=0){let e=!1;return!t.includes("px")||t.includes("r")||t.includes("u")?t.includes("rpx")?t=Number(t.split("rpx")[0]):t.includes("upx")&&(t=Number(t.split("upx")[0])):(t=Number(t.split("px")[0]),e=!0),e?t:i.index.upx2px(t)}conversionUnit(t){return l.conversionUnit(t,this.getConvertedValue,this)}getGlobalDataDrawParams(t={}){const{width:i}=this,{x:l=0,y:h=0,w:d=i,h:c=0,r:u=0,color:x="black",alpha:p=1,isFill:g=!0,lineWidth:y=1,windowAlign:f="none",rotate:m={},drawImage:b=!1,borderColor:w="#000000",borderWidth:C=0,borderType:P="default",offsetRight:S=0,shadow:v,gradient:M={}}=t;return I=((t,e)=>{for(var r in e||(e={}))o.call(e,r)&&s(t,r,e[r]);if(n)for(var r of n(e))a.call(e,r)&&s(t,r,e[r]);return t})({},{x:l,y:h,w:d,h:c,r:u}),T={color:x,lineWidth:y,borderWidth:C,borderColor:w,borderType:P,alpha:p,isFill:g,windowAlign:f,rotate:m,shadow:this.getShadow(v),gradient:M,offsetRight:S,drawImage:b},e(I,r(T));var I,T}getShadow(t={}){const{show:e=!1,x:r=0,y:n=0,blur:o=0,color:a="#000000"}=t;return{show:e,x:r,y:n,blur:o,color:a}}getGradient(t="linear",e=!0,r={},n=[],o={}){const{x0:a=0,y0:s=0,x1:i=0,y1:l=0,x:h=0,y:d=0,r:c=0}=r;return"linear"==t?(r.x0=e?a+o.x:a,r.y0=e?s+o.y:s,r.x1=e?i+o.x:i,r.y1=e?l+o.y:l):(r.x=e?h+o.x:h,r.y=e?d+o.y:d,r.r=c),"linear"==t?this.getLinearGradient(r,n):this.getCircularGradient(r,n)}getLinearGradient(t={},e=[]){const{Context:r}=this,{x0:n,y0:o,x1:a,y1:s}=t,i=r.createLinearGradient(n,o,a,s);for(let l of e)i.addColorStop(l.stop,l.color);return i}getCircularGradient(t={},e=[]){const{Context:r}=this,{x:n,y:o,r:a}=t,s=r.createCircularGradient(n,o,a);for(let i of e)s.addColorStop(i.stop,i.color);return s}},exports.sleep=function(t=300){return new Promise((e=>{setTimeout((()=>{e(!0)}),t)}))};
