"use strict";var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,i=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,l=require("../plugins/qrcodeAlg.js");exports.DrawQrcode=class{constructor(e){const{Context:o,commonUtilMethods:t,commonDrawMethods:r}=e;this.Context=o,this.commonUtilMethods=t,this.commonDrawMethods=r}getDrawParams(e={},l=!0){const s=this.commonUtilMethods.getGlobalDataDrawParams(e),{text:a="",image:d={},size:u=100,lv:m=3,background:f="#ffffff",foreground:g="#000000",pdground:h="#000000"}=e,w=(b=((e,o)=>{for(var t in o||(o={}))n.call(o,t)&&i(e,t,o[t]);if(r)for(var t of r(o))c.call(o,t)&&i(e,t,o[t]);return e})({},s),p={text:String(a)||"",image:d,size:u,correctLevel:m,background:f,foreground:g,pdground:h},o(b,t(p)));var b,p;return l?this.commonUtilMethods.conversionUnit(w):w}draw(e={},o=!0){const{Context:t,commonUtilMethods:i,commonDrawMethods:s}=this,{canvasWidth:a,is2d:d}=i;let u=this.getDrawParams(e,o),{x:m,y:f,image:g,windowAlign:h,offsetRight:w}=u,b=((e,o)=>{var t={};for(var i in e)n.call(e,i)&&o.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&r)for(var i of r(e))o.indexOf(i)<0&&c.call(e,i)&&(t[i]=e[i]);return t})(u,["x","y","image","windowAlign","offsetRight"]);return new Promise((async e=>{"none"!==h&&(m=s.computedCenterX(a,b.size,h,w));let r=[],n=null,c=r.length,d=0;for(let o=0;o<c;o++)if(d=o,r[o].text==b.text&&r[o].text.correctLevel==b.correctLevel){n=r[o].obj;break}d==c&&(n=new l.QRCodeAlg(b.text,b.correctLevel),r.push({text:b.text,correctLevel:b.correctLevel,obj:n}));let u=function(e){let o=e.options;return o.pdground&&(e.row>1&&e.row<5&&e.col>1&&e.col<5||e.row>e.count-6&&e.row<e.count-2&&e.col>1&&e.col<5||e.row>1&&e.row<5&&e.col>e.count-6&&e.col<e.count-2)?o.pdground:o.foreground},p=n.getModuleCount(),v=b.size,x=i.getConvertedValue(g.size)||30,M=(v/p).toPrecision(4),y=(v/p).toPrecision(4);for(let o=0;o<p;o++)for(let e=0;e<p;e++){let r=Math.ceil((e+1)*M)-Math.floor(e*M),c=Math.ceil((o+1)*M)-Math.floor(o*M),i=u({row:o,col:e,count:p,options:b});s.setFillStyle(n.modules[o][e]?i:b.background),t.fillRect(m+Math.round(e*M),f+Math.round(o*y),r,c)}if(g.src){const{src:t,r:r,color:n,borderWidth:c,borderColor:i}=o?this.commonUtilMethods.conversionUnit(g):g,l=m+Number(((v-x)/2).toFixed(2)),a=f+Number(((v-x)/2).toFixed(2)),d=await s.drawParams.drawImage.draw({x:l,y:a,w:x,h:x,src:t,r:r,color:n,borderWidth:c,borderColor:i,drawType:"rect",isCompressImage:!1},!1);if(!d.success)return e(d)}return e({success:!0})}))}};
