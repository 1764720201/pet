"use strict";var o=require("../../../../common/vendor.js"),u=require("../plugins/image-tools.js");const d=(e,s,t)=>{const l=g(e,s,t);return l!==0?l:s.length*t};function g(e,s,t){var n;if(e.measureText)return((n=e.measureText(s))==null?void 0:n.width)||0;let l=0;for(let i of s)l+=m(i);return l*t}function m(e){let s;return/a/.test(e)?s=.552734375:/b/.test(e)?s=.638671875:/c/.test(e)?s=.50146484375:/d/.test(e)?s=.6396484375:/e/.test(e)?s=.5673828125:/f/.test(e)?s=.3466796875:/g/.test(e)?s=.6396484375:/h/.test(e)?s=.61572265625:/i/.test(e)?s=.26611328125:/j/.test(e)?s=.26708984375:/k/.test(e)?s=.54443359375:/l/.test(e)?s=.26611328125:/m/.test(e)?s=.93701171875:/n/.test(e)?s=.6162109375:/o/.test(e)?s=.6357421875:/p/.test(e)?s=.638671875:/q/.test(e)?s=.6396484375:/r/.test(e)?s=.3818359375:/s/.test(e)?s=.462890625:/t/.test(e)?s=.37255859375:/u/.test(e)?s=.6162109375:/v/.test(e)?s=.52490234375:/w/.test(e)?s=.78955078125:/x/.test(e)?s=.5068359375:/y/.test(e)?s=.529296875:/z/.test(e)?s=.49169921875:/A/.test(e)?s=.70361328125:/B/.test(e)?s=.62744140625:/C/.test(e)?s=.6689453125:/D/.test(e)?s=.76171875:/E/.test(e)?s=.5498046875:/F/.test(e)?s=.53125:/G/.test(e)?s=.74365234375:/H/.test(e)?s=.7734375:/I/.test(e)?s=.2939453125:/J/.test(e)?s=.39599609375:/K/.test(e)?s=.634765625:/L/.test(e)?s=.51318359375:/M/.test(e)?s=.97705078125:/N/.test(e)?s=.81298828125:/O/.test(e)?s=.81494140625:/P/.test(e)?s=.61181640625:/Q/.test(e)?s=.81494140625:/R/.test(e)?s=.65283203125:/S/.test(e)?s=.5771484375:/T/.test(e)?s=.5732421875:/U/.test(e)?s=.74658203125:/V/.test(e)?s=.67626953125:/W/.test(e)?s=1.017578125:/X/.test(e)?s=.64501953125:/Y/.test(e)?s=.603515625:/Z/.test(e)?s=.6201171875:/[0-9]/.test(e)?s=.58642578125:/[\u4e00-\u9fa5]/.test(e)?s=1:/ /.test(e)?s=.2958984375:/\`/.test(e)?s=.294921875:/\~/.test(e)?s=.74169921875:/\!/.test(e)?s=.3125:/\@/.test(e)?s=1.03125:/\#/.test(e)?s=.63818359375:/\$/.test(e)?s=.58642578125:/\%/.test(e)?s=.8896484375:/\^/.test(e)?s=.74169921875:/\&/.test(e)?s=.8701171875:/\*/.test(e)?s=.455078125:/\(/.test(e)||/\)/.test(e)?s=.333984375:/\_/.test(e)?s=.4482421875:/\-/.test(e)?s=.4326171875:/\+/.test(e)||/\=/.test(e)?s=.74169921875:/\|/.test(e)?s=.26904296875:/\\/.test(e)?s=.416015625:/\[/.test(e)||/\]/.test(e)?s=.333984375:/\;/.test(e)?s=.24072265625:/\'/.test(e)?s=.25634765625:/\,/.test(e)||/\./.test(e)?s=.24072265625:/\//.test(e)?s=.42724609375:/\{/.test(e)||/\}/.test(e)?s=.333984375:/\:/.test(e)?s=.24072265625:/\"/.test(e)?s=.435546875:/\</.test(e)||/\>/.test(e)?s=.74169921875:/\?/.test(e)?s=.48291015625:s=1,s}const c=(e,s,t)=>{const l=["quality","alpha","deg","zIndex","e","s","drawImage"],n=()=>{const i=Object.assign({},e);return Object.keys(e).forEach(f=>{const r=e[f];l.includes(f)||(typeof r=="number"?r!==375.0001&&(i[f]=s.call(t,r)):typeof r=="object"&&!r instanceof Array?i[f]=c(i[f],s,t):r instanceof Array&&(i[f]=r.map(a=>typeof a=="number"?s.call(t,a):a)))}),i};return e instanceof Array?(()=>e.map(f=>c(f,s,t)))():n()},h=(e,s={})=>new Promise(t=>{const{header:l={}}=s;try{const n=o.index.downloadFile({url:e,header:l,success:i=>t({success:!0,data:i}),fail:i=>t({success:!1,message:`\u4E0B\u8F7D\u8D44\u6E90${e}\u5931\u8D25---${JSON.stringify(i)}`})})}catch(n){return t({success:!1,msg:`\u4E0B\u8F7D\u8D44\u6E90${e}\u5931\u8D25---${JSON.stringify(n)}`})}}),b=e=>/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)?u.base64ToPath(e):Promise.resolve(e),T=e=>new Promise(s=>{o.index.showLoading({title:"\u4FDD\u5B58\u4E2D..."}),o.index.saveImageToPhotosAlbum({filePath:e,success:t=>{s({success:!0,data:t.file})},fail:t=>{s({success:!1,message:t})},complete:()=>{o.index.hideLoading()}})});exports.base64ToPathFn=b;exports.conversionUnit=c;exports.countTextLength=d;exports.downloadFile=h;exports.saveImageToPhotosAlbum=T;
