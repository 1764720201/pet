"use strict";var E=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var q=(g,t,e)=>t in g?E(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e,B=(g,t)=>{for(var e in t||(t={}))Q.call(t,e)&&q(g,e,t[e]);if(O)for(var e of O(t))Z.call(t,e)&&q(g,e,t[e]);return g},Y=(g,t)=>J(g,K(t));var R=require("../../../../common/vendor.js"),U=require("./util.js");class ${constructor(t){const{unit:e,type:s,width:o,height:l,fontStyle:n}=t;this.unit=e,this.type=s,this.is2d=s==="2d",this.width=o,this.height=l,this.fontStyle=n,this.Context=null,this.canvas=null}setCanvasStyle(){const{width:t,height:e}=this;this.canvasWidth=this.getConvertedValue(t),this.canvasHeight=this.getConvertedValue(e)}getConvertedValue(t=0){return t===0?0:this.unit==="px"?t:t===375.0001?375.0001:R.index.upx2px(t)}pxToRpx(t=0){return t/(R.index.upx2px(100)/100)}rpxToPx(t=0){let e=!1;return t.includes("px")&&!t.includes("r")&&!t.includes("u")?(t=Number(t.split("px")[0]),e=!0):t.includes("rpx")?t=Number(t.split("rpx")[0]):t.includes("upx")&&(t=Number(t.split("upx")[0])),e?t:R.index.upx2px(t)}conversionUnit(t){return U.conversionUnit(t,this.getConvertedValue,this)}getGlobalDataDrawParams(t={}){const{width:e}=this,{x:s=0,y:o=0,w:l=e,h:n=0,r:i=0,color:d="black",alpha:a=1,isFill:r=!0,lineWidth:h=1,windowAlign:M="none",rotate:k={},drawImage:W=!1,borderColor:b="#000000",borderWidth:I=0,borderType:X="default",offsetRight:m=0,shadow:P,gradient:y={}}=t;return Y(B({},{x:s,y:o,w:l,h:n,r:i}),{color:d,lineWidth:h,borderWidth:I,borderColor:b,borderType:X,alpha:a,isFill:r,windowAlign:M,rotate:k,shadow:this.getShadow(P),gradient:y,offsetRight:m,drawImage:W})}getShadow(t={}){const{show:e=!1,x:s=0,y:o=0,blur:l=0,color:n="#000000"}=t;return{show:e,x:s,y:o,blur:l,color:n}}getGradient(t="linear",e=!0,s={},o=[],l={}){const{x0:n=0,y0:i=0,x1:d=0,y1:a=0,x:r=0,y:h=0,r:M=0}=s;return t=="linear"?(s.x0=e?n+l.x:n,s.y0=e?i+l.y:i,s.x1=e?d+l.x:d,s.y1=e?a+l.y:a):(s.x=e?r+l.x:r,s.y=e?h+l.y:h,s.r=M),t=="linear"?this.getLinearGradient(s,o):this.getCircularGradient(s,o)}getLinearGradient(t={},e=[]){const{Context:s}=this,{x0:o,y0:l,x1:n,y1:i}=t,d=s.createLinearGradient(o,l,n,i);for(let a of e)d.addColorStop(a.stop,a.color);return d}getCircularGradient(t={},e=[]){const{Context:s}=this,{x:o,y:l,r:n}=t,i=s.createCircularGradient(o,l,n);for(let d of e)i.addColorStop(d.stop,d.color);return i}}class A{constructor(t,e,s){this.Context=t,this.type=e,this.is2d=e==="2d",this.commonUtilMethods=s,this.drawParams={}}setAlpha(t=1){const{Context:e,is2d:s}=this;s?e.globalAlpha=t:e.setGlobalAlpha(t)}setFillStyle(t){const{Context:e,is2d:s}=this;s?e.fillStyle=t:e.setFillStyle(t)}setLineWidth(t){const{Context:e,is2d:s}=this;s?e.lineWidth=t:e.setLineWidth(t)}setStrokeStyle(t){const{Context:e,is2d:s}=this;s?e.strokeStyle=t:e.setStrokeStyle(t)}setShadow(t,e,s,o){const{Context:l,is2d:n}=this;l.shadowOffsetX=t,l.shadowOffsetY=e,l.shadowColor=o,l.shadowBlur=s}setRotate(t,e,s,o,l){const{Context:n}=this,{deg:i=0,type:d="middle"}=l;let a=t,r=e;switch(d){case"topLeft":n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"topMiddle":a=t+s/2,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"topRight":a=t+s,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"bottomLeft":r=e+o,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"bottomMiddle":a=t+s/2,r=e+o,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"bottomRight":a=t+s,r=e+o,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"middleLeft":r=e+o/2,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"middleRight":a=t+s,r=e+o/2,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break;case"middle":a=t+s/2,r=e+o/2,n.translate(a,r),n.rotate(i*Math.PI/180),n.translate(-a,-r);break}}setTriangleRotate(t,e,s,o,l,n){const{Context:i}=this,{deg:d=0,type:a="middle"}=l;let r=t,h=e;switch(a){case"top":n=="right"?(r=t,h=e):(r=t+s/2,h=e),i.translate(r,h),i.rotate(d*Math.PI/180),i.translate(-r,-h);break;case"left":r=t,h=e+o,i.translate(r,h),i.rotate(d*Math.PI/180),i.translate(-r,-h);break;case"right":r=t+s,h=e+o,i.translate(r,h),i.rotate(d*Math.PI/180),i.translate(-r,-h);break;case"middle":r=t+s/2,h=e+o/2,i.translate(r,h),i.rotate(d*Math.PI/180),i.translate(-r,-h);break}}computedCenterX(t,e,s="center",o=0){return s==="center"?(t-e)/2-o:s==="right"?t-e-o:0}computedFontTextLineHeight(t,e,s,o,l,n,i,d,a,r,h,M){const{Context:k,commonUtilMethods:W}=this,{canvasWidth:b,getConvertedValue:I,is2d:X}=W,{fontSize:m}=i;k.font=i.style;let{lineNum:P,lineHeight:y,lineStyle:w}=d,z=U.countTextLength(k,o,m);(s==0||s==375.0001)&&(z>b?s=b:s=z+m);let G=[];function F(u){let c="";const f=[],D=[];for(let S in u){c+=u[S];let T=U.countTextLength(k,c,m);if(l!=0&&f.length===0&&(T+=l),T>=s-m||S==u.length-1){const x=f.length==0?0:f[f.length-1].index,C=Object.assign([],D).splice(x,S),p=n!=0&&C.length!=0&&C.reverse().find(_=>_.length<=n);f.push({length:T,text:c,index:S-1,lastText:c.substring(0,c.length-1)+"...",limitText:p?p.text+"...":"",limitTextWidth:U.countTextLength(k,p.text+"...",m)}),c=""}D.push({index:S,text:c,length:T})}return f}if(o.includes(`
`)){const u=o.split(`
`);for(let c of u)G.push(...F(c))}else G=F(o);y=y==1?m+2:y;let j=G.length,V=P!=-1?P:j;V>j&&(V=j);let N=[];for(let u=0;u<V;u++){let{text:c,length:f,lastText:D,limitText:S,limitTextWidth:T}=G[u],x={},C=t,p=t;if(u==0&&l!=0&&a=="none"&&r=="none"&&(f+=l,C+=l,p=C),c&&P!=-1&&u==P-1&&(n>0?(c=S,f=T):c=f+m>=s?D:c),a!=="none"&&f<=s){let H=s;f==s&&(H=b),p=this.computedCenterX(H,f,a),C+=p}r!=="none"&&a!=="none"?(C=this.computedCenterX(b,s,r,M),C+=p,p=C):r!=="none"&&(C=this.computedCenterX(b,s,r,M),p=C);let _=0,L=e+u*y;w!=="none"&&(p=p+I(0),_=f+I(0),w=="underline"?L+=m+1:w=="lineThrough"&&(L+=m/2,R.index.getSystemInfoSync().platform==="android"&&this.type!=="2d"&&(L+=i.fontSize/6))),x.w=f,x.text=c,x.x=C,y==0?(x.y=e+m*u,L=L+m*u):x.y=e+y*u,x.fontColor=h,x.lineColor=h,x.tw=_,x.ty=L,x.tx=p,x.ey=x.y+m,c&&N.push(x)}return N}}function v(g=300){return new Promise(t=>{setTimeout(()=>{t(!0)},g)})}exports.CommonDrawMethods=A;exports.CommonUtilMethods=$;exports.sleep=v;
