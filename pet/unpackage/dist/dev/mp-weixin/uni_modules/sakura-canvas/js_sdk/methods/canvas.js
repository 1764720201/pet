"use strict";var T=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var g=(a,e,t)=>e in a?T(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,p=(a,e)=>{for(var t in e||(e={}))j.call(e,t)&&g(a,t,e[t]);if(x)for(var t of x(e))q.call(e,t)&&g(a,t,e[t]);return a},y=(a,e)=>D(a,F(e));var m=require("../../../../common/vendor.js"),P=require("../utils/common.js");class k{constructor(e){this.drawPoster=e}clearCanvas(){const{Context:e}=this.drawPoster;e.clearRect(0,0,999999,999999)}exportImage(){const{exportImageDelayTime:e,exportImageTips:t}=this.drawPoster;return new Promise(async s=>{m.index.showLoading({title:t}),await P.sleep(e),s(await this.createCanvasFilePath())})}createCanvasFilePath(){const{Context:e,canvas:t,canvasId:s,_this:r,is2d:n,exportImageStyle:f,dpr:u}=this.drawPoster;let{width:o,height:c,x:v,y:I,fileType:C,quality:_,destWidth:l,destHeight:w}=f;const d={};return l&&(d.destWidth=l),w&&(d.destHeight=w),n&&(o=o*u,c=c*u),new Promise(h=>{try{m.index.canvasToTempFilePath(y(p({canvasId:s,canvas:t,x:v,y:I,width:Math.floor(o),height:Math.floor(c),quality:_,fileType:C},d),{success:i=>h({success:!0,data:i.tempFilePath,msg:"\u7ED8\u753B\u6210\u529F"}),fail:i=>h({success:!1,msg:`\u5BFC\u51FA\u56FE\u7247\u5931\u8D25: ${JSON.stringify(i)}`}),complete:()=>{m.index.hideLoading()}}),r)}catch(i){return h({success:!1,msg:"\u5BFC\u51FA\u56FE\u7247\u5931\u8D25: \u7ED8\u753B\u9519\u8BEF"+i})}})}canvasDraw(){const{Context:e,drawDelayTime:t,is2d:s}=this.drawPoster;return new Promise(async r=>{if(await P.sleep(t),s)return r(await this.exportImage());await e.draw(!0,async()=>r(await this.exportImage()))})}sortDrawArray(e=[]){return e.sort((t,s)=>{const r=t.zIndex||0,n=s.zIndex||0;return r-n})}}exports.Canvas=k;
