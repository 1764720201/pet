"use strict";var N=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var L=(r,e,o)=>e in r?N(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,k=(r,e)=>{for(var o in e||(e={}))_.call(e,o)&&L(r,o,e[o]);if(b)for(var o of b(e))j.call(e,o)&&L(r,o,e[o]);return r},F=(r,e)=>H(r,O(e));var I=(r,e)=>{var o={};for(var s in r)_.call(r,s)&&e.indexOf(s)<0&&(o[s]=r[s]);if(r!=null&&b)for(var s of b(r))e.indexOf(s)<0&&j.call(r,s)&&(o[s]=r[s]);return o};var T=require("../plugins/qrcodeAlg.js");class V{constructor(e){const{Context:o,commonUtilMethods:s,commonDrawMethods:n}=e;this.Context=o,this.commonUtilMethods=s,this.commonDrawMethods=n}getDrawParams(e={},o=!0){const s=this.commonUtilMethods.getGlobalDataDrawParams(e),{text:n="",image:d={},size:p=100,lv:P=3,background:i="#ffffff",foreground:x="#000000",pdground:c="#000000"}=e,u=F(k({},s),{text:String(n)||"",image:d,size:p,correctLevel:P,background:i,foreground:x,pdground:c});return o?this.commonUtilMethods.conversionUnit(u):u}draw(e={},o=!0){const{Context:s,commonUtilMethods:n,commonDrawMethods:d}=this,{canvasWidth:p,is2d:P}=n;let U=this.getDrawParams(e,o),{x:i,y:x,image:c,windowAlign:u,offsetRight:S}=U,a=I(U,["x","y","image","windowAlign","offsetRight"]);return new Promise(async q=>{u!=="none"&&(i=d.computedCenterX(p,a.size,u,S));let m=[],h=null,y=m.length,z=0;for(let t=0;t<y;t++)if(z=t,m[t].text==a.text&&m[t].text.correctLevel==a.correctLevel){h=m[t].obj;break}z==y&&(h=new T.QRCodeAlg(a.text,a.correctLevel),m.push({text:a.text,correctLevel:a.correctLevel,obj:h}));let Q=function(t){let l=t.options;return l.pdground&&(t.row>1&&t.row<5&&t.col>1&&t.col<5||t.row>t.count-6&&t.row<t.count-2&&t.col>1&&t.col<5||t.row>1&&t.row<5&&t.col>t.count-6&&t.col<t.count-2)?l.pdground:l.foreground},w=h.getModuleCount(),M=a.size,C=n.getConvertedValue(c.size)||30,g=(M/w).toPrecision(4),R=(M/w).toPrecision(4);for(let t=0;t<w;t++)for(let l=0;l<w;l++){let v=Math.ceil((l+1)*g)-Math.floor(l*g),f=Math.ceil((t+1)*g)-Math.floor(t*g),D=Q({row:t,col:l,count:w,options:a});d.setFillStyle(h.modules[t][l]?D:a.background),s.fillRect(i+Math.round(l*g),x+Math.round(t*R),v,f)}if(c.src){const{src:t,r:l,color:v,borderWidth:f,borderColor:D}=o?this.commonUtilMethods.conversionUnit(c):c,W=i+Number(((M-C)/2).toFixed(2)),G=x+Number(((M-C)/2).toFixed(2)),A=await d.drawParams.drawImage.draw({x:W,y:G,w:C,h:C,src:t,r:l,color:v,borderWidth:f,borderColor:D,drawType:"rect",isCompressImage:!1},!1);if(!A.success)return q(A)}return q({success:!0})})}}exports.DrawQrcode=V;
