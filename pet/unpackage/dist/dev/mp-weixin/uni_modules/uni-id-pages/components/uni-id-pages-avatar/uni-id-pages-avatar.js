"use strict";var e=require("../../../../common/vendor.js");const h=e.pn.database(),u=h.collection("uni-id-users"),g={data(){return{userInfo:{},isPC:!1,hasLogin:!1}},props:{width:{type:String,default(){return"50px"}},height:{type:String,default(){return"50px"}}},async mounted(){u.where("'_id' == $cloudEnv_uid").field("avatar_file,mobile,nickname").get().then(i=>{this.userInfo=i.result.data[0]||{},console.log("this.userInfo",this.userInfo),this.hasLogin=!0}).catch(i=>{this.userInfo={},this.hasLogin=!1,console.log(i.message,i.errCode)})},computed:{avatar_file(){if(this.userInfo.avatar_file&&this.userInfo.avatar_file.url)return this.userInfo.avatar_file}},methods:{setAvatarFile(i){e.index.showLoading({title:"\u8BBE\u7F6E\u4E2D",mask:!0}),u.where("_id==$env.uid").update({avatar_file:i}).then(t=>{console.log(t),i?e.index.showToast({icon:"none",title:"\u66F4\u65B0\u6210\u529F"}):e.index.showToast({icon:"none",title:"\u5220\u9664\u6210\u529F"}),this.$set(this.userInfo,"avatar_file",i)}).catch(t=>{e.index.showModal({content:t.message||"\u8BF7\u6C42\u5931\u8D25",showCancel:!1})}).finally(()=>{e.index.hideLoading()})},uploadAvatarImg(i){if(!this.hasLogin)return e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"});const t={quality:100,width:600,height:600,resize:!0};e.index.chooseImage({count:1,crop:t,success:async a=>{console.log(a);let l=a.tempFiles[0],s={extname:l.path.split(".")[l.path.split(".").length-1]},n=a.tempFilePaths[0];this.isPC||(n=await new Promise(d=>{e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/cropImage/cropImage?path="+n+`&options=${JSON.stringify(t)}`,animationType:"fade-in",events:{success:r=>{d(r)}},complete(r){console.log(r)}})})),console.log(this.userInfo);let o=this.userInfo._id+""+Date.now();s.name=o,e.index.showLoading({title:"\u66F4\u65B0\u4E2D",mask:!0});let{fileID:c}=await e.pn.uploadFile({filePath:n,cloudPath:o,fileType:"image"});s.url=c,console.log({avatar_file:s}),e.index.hideLoading(),this.setAvatarFile(s)}})}}};if(!Array){const i=e.resolveComponent("cloud-image"),t=e.resolveComponent("uni-icons");(i+t)()}const m=()=>"../cloud-image/cloud-image.js",f=()=>"../../../uni-icons/components/uni-icons/uni-icons.js";Math||(m+f)();function p(i,t,a,l,s,n){return e.e({a:n.avatar_file},n.avatar_file?{b:e.p({src:n.avatar_file.url,width:a.width,height:a.height})}:{c:a.width,d:a.height,e:a.height,f:e.p({type:"plusempty",size:"30",color:"#dddddd"})},{g:e.o((...o)=>n.uploadAvatarImg&&n.uploadAvatarImg(...o))})}var _=e._export_sfc(g,[["render",p],["__file","C:/Users/yzc/Desktop/pet/uni_modules/uni-id-pages/components/uni-id-pages-avatar/uni-id-pages-avatar.vue"]]);wx.createComponent(_);
