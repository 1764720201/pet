"use strict";var x=Object.defineProperty,v=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var _=(e,i,o)=>i in e?x(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,d=(e,i)=>{for(var o in i||(i={}))b.call(i,o)&&_(e,o,i[o]);if(m)for(var o of m(i))w.call(i,o)&&_(e,o,i[o]);return e},f=(e,i)=>v(e,y(i));var n=require("../../../../common/vendor.js"),g=require("../../config.js"),p=require("../../common/loginSuccess.js");const C=n.pn.database();C.collection("uni-id-users");const S={computed:{agreements(){if(!g.config.agreements)return[];let{serviceUrl:e,privacyUrl:i}=g.config.agreements;return[{url:e,title:"\u7528\u6237\u670D\u52A1\u534F\u8BAE"},{url:i,title:"\u9690\u79C1\u653F\u7B56\u6761\u6B3E"}]},agree:{get(){return this.getParentComponent().agree},set(e){return console.log("setAgree",e),this.getParentComponent().agree=e}}},data(){return{servicesList:[{id:"username",text:"\u8D26\u53F7\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/user.png",path:"/uni_modules/uni-id-pages/pages/login/login-withpwd"},{id:"smsCode",text:"\u77ED\u4FE1\u9A8C\u8BC1\u7801",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/sms.png",path:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=smsCode"},{id:"weixin",text:"\u5FAE\u4FE1\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/weixin.png"},{id:"apple",text:"\u82F9\u679C\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/apple.png"},{id:"univerify",text:"\u4E00\u952E\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/univerify.png"},{id:"taobao",text:"\u6DD8\u5B9D\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/taobao.png"},{id:"facebook",text:"\u8138\u4E66\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/facebook.png"},{id:"alipay",text:"\u652F\u4ED8\u5B9D\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/alipay.png"},{id:"qq",text:"QQ\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/qq.png"},{id:"google",text:"\u8C37\u6B4C\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/google.png"},{id:"douyin",text:"\u6296\u97F3\u767B\u5F55",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/douyin.png"},{id:"sinaweibo",text:"\u65B0\u6D6A\u5FAE\u535A",logo:"/uni_modules/uni-id-pages/static/uni-fab-login/sinaweibo.png"}],univerifyStyle:{fullScreen:!0,backgroundColor:"#ffffff",buttons:{iconWidth:"45px",list:[]},privacyTerms:{defaultCheckBoxState:!1,textColor:"#BBBBBB",termsColor:"#5496E3",prefix:"\u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F",suffix:"\u5E76\u4F7F\u7528\u672C\u673A\u53F7\u7801\u767B\u5F55",privacyItems:[]}}}},watch:{agree(e){this.univerifyStyle.privacyTerms.defaultCheckBoxState=e}},async created(){let e=this.servicesList,i=g.config.loginTypes;e=e.filter(o=>o.id=="apple"?!1:i.includes(o.id)),i.includes("univerify")&&(this.univerifyStyle.privacyTerms.privacyItems=this.agreements,e.forEach(({id:o,logo:l,path:s})=>{o!="univerify"&&this.univerifyStyle.buttons.list.push({iconPath:l,provider:o,path:s})})),this.servicesList=e.filter(o=>(o.path?o.path.split("?")[0]:"")!=this.getRoute(1))},methods:{getParentComponent(){return this.$parent},setUserInfo(e){console.log("setUserInfo",e)},getRoute(e=0){let i=getCurrentPages();return e>i.length?"":"/"+i[i.length-e].route},navigateTo(e){if(this.getRoute(1)==e.split("?")[0]&&this.getRoute(1)=="/uni_modules/uni-id-pages/pages/login/login-withoutpwd"){let i=e.split("?")[1].split("=")[1];n.index.$emit("uni-id-pages-set-login-type",i)}else this.getRoute(2)==e?n.index.navigateBack():this.getRoute(1)!=e?n.index.navigateTo({url:e,animationType:"slide-in-left",complete(i){}}):console.log("\u51FA\u4E4E\u610F\u6599\u7684\u60C5\u51B5,path\uFF1A"+e)},async login_before(e,i=!0){var l,s;if(console.log(e),["qq","xiaomi","sinaweibo","taobao","facebook","google","alipay","douyin"].includes(e))return n.index.showToast({title:"\u8BE5\u767B\u5F55\u65B9\u5F0F\u6682\u672A\u5B9E\u73B0\uFF0C\u6B22\u8FCE\u63D0\u4EA4pr",icon:"none"});if(["univerify","apple"].includes(e))return n.index.showToast({title:"\u5F53\u524D\u8BBE\u5907\u4E0D\u652F\u6301\u6B64\u767B\u5F55\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u767B\u5F55\u65B9\u5F0F",icon:"none"});console.log(e,this.agree);let o=(((s=(l=g.config)==null?void 0:l.agreements)==null?void 0:s.scope)||[]).includes("register");if(console.log({needAgreements:o}),e!="univerify"&&o&&!this.agree)return this.getParentComponent().$refs.agreements.popup(()=>{console.log(e,i),this.login_before(e,i)});if(e=="univerify"){let u=function(){n.index.hideLoading(),t.close(),t.offButtonsClick(r)},t=n.index.getUniverifyManager(),r=async a=>{console.log("\u70B9\u51FB\u4E86\u7B2C\u4E09\u65B9\u767B\u5F55\uFF0Cprovider\uFF1A",a,a.provider,this.univerifyStyle.buttons.list);let c=(await n.index.getCheckBoxState())[1].state;this.agree=c;let{path:h}=this.univerifyStyle.buttons.list[a.index];h?(this.navigateTo(h),u()):c?(u(),setTimeout(()=>{this.login_before(a.provider)},500)):n.index.showToast({title:"\u4F60\u672A\u540C\u610F\u9690\u79C1\u653F\u7B56\u534F\u8BAE",icon:"none"})};return t.onButtonsClick(r),t.login({univerifyStyle:this.univerifyStyle,success:a=>{console.log("login success",a),this.login(a.authResult,"univerify")},fail(a){n.index.showToast({title:JSON.stringify(a),icon:"none"})},complete:async a=>{console.log(a),n.index.hideLoading(),this.agree=(await n.index.getCheckBoxState())[1].state,t.offButtonsClick(r)}})}n.index.showLoading({mask:!0}),n.index.login({provider:e,onlyAuthorize:!0,success:async t=>{if(console.log(t),e=="apple"){let r=await this.getUserInfo({provider:"apple"});Object.assign(t.authResult,r.userInfo),n.index.hideLoading()}this.login(e=="weixin"?{code:t.code}:t.authResult,e)},fail:async t=>{console.log(t),n.index.hideLoading()}})},login(e,i){console.log("\u6267\u884C\u767B\u5F55\u5F00\u59CB----"),console.log({params:e,type:i});let o="loginBy"+i.trim().toLowerCase().replace(i[0],i[0].toUpperCase());n.pn.importObject("uni-id-co",{customUI:!0})[o](e).then(s=>{if(console.log("login-result",s),n.index.showToast({title:"\u767B\u5F55\u6210\u529F",icon:"none"}),i=="weixin"&&s.type=="register")return p.loginSuccess(f(d({},s),{showToast:!1,autoBack:!1})),this.$refs.userProfile.open(s.uid);p.loginSuccess(s)}).catch(s=>{console.log(s),n.index.showModal({content:s.message,confirmText:"\u77E5\u9053\u4E86",showCancel:!1})}).finally(s=>{i=="univerify"&&n.index.closeAuthView(),n.index.hideLoading()})},doUserProfileNext(){try{p.loginSuccess()}catch(e){console.log(e)}},async getUserInfo(e){return new Promise((i,o)=>{n.index.getUserInfo(f(d({},e),{success:l=>{i(l)},fail:l=>{n.index.showModal({content:JSON.stringify(l),showCancel:!1}),o(l)}}))})}}};Array||n.resolveComponent("uni-id-pages-user-profile")();const T=()=>"../uni-id-pages-user-profile/uni-id-pages-user-profile.js";Math||T();function B(e,i,o,l,s,t){return{a:n.f(s.servicesList,(r,u,a)=>({a:r.logo,b:n.t(r.text),c:u,d:n.o(c=>r.path?t.navigateTo(r.path):t.login_before(r.id,!1),u)})),b:n.sr("userProfile","12b99efe-0"),c:n.o(t.doUserProfileNext)}}var k=n._export_sfc(S,[["render",B],["__file","C:/Users/yzc/Desktop/pet/uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue"]]);wx.createComponent(k);
