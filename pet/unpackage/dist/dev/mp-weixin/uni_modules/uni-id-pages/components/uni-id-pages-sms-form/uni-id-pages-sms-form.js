"use strict";var e=require("../../../../common/vendor.js");function u(t,n){let s;return n=n||500,function(){let a=this,o=arguments;s&&clearTimeout(s);let r=!s;s=setTimeout(()=>{s=null},n),r&&t.apply(a,o)}}const c={name:"uni-sms-form",model:{prop:"modelValue",event:"update:modelValue"},props:{event:["update:modelValue"],count:{type:[String,Number],default:60},phone:{type:[String,Number],default:""},type:{type:String,default(){return"login"}},focusCaptchaInput:{type:Boolean,default(){return!1}}},data(){return{captcha:"",reverseNumber:0,reverseTimer:null,modelValue:"",focusSmsCodeInput:!1}},watch:{captcha(t,n){t.length==4&&n.length!=4&&this.start()},modelValue(t){this.$emit("input",t),this.$emit("update:modelValue",t)}},computed:{innerText(){return this.reverseNumber==0?"\u83B7\u53D6\u77ED\u4FE1\u9A8C\u8BC1\u7801":"\u91CD\u65B0\u53D1\u9001("+this.reverseNumber+"s)"}},created(){this.initClick()},methods:{getImageCaptcha(t){this.$refs.captcha.getImageCaptcha(t)},initClick(){this.start=u(()=>{this.reverseNumber==0&&this.sendMsg()})},sendMsg(){if(this.captcha.length!=4)return this.$refs.captcha.focusCaptchaInput=!0,e.index.showToast({title:"\u8BF7\u5148\u8F93\u5165\u56FE\u5F62\u9A8C\u8BC1\u7801",icon:"none"});if(!/^1\d{10}$/.test(this.phone))return e.index.showToast({title:"\u624B\u673A\u53F7\u683C\u5F0F\u9519\u8BEF",icon:"none"});const n=e.pn.importObject("uni-id-co",{customUI:!0});console.log("sendSmsCode",{mobile:this.phone,scene:this.type,captcha:this.captcha}),n.sendSmsCode({mobile:this.phone,scene:this.type,captcha:this.captcha}).then(s=>{console.log(s.code),e.index.showToast({title:"\u77ED\u4FE1\u9A8C\u8BC1\u7801\u53D1\u9001\u6210\u529F",icon:"none"}),this.reverseNumber=Number(this.count),this.getCode()}).catch(s=>{console.log(JSON.stringify(s)),s.code=="uni-id-invalid-sms-template-id"?(this.modelValue="123456",e.index.showToast({title:"\u5DF2\u542F\u52A8\u6D4B\u8BD5\u6A21\u5F0F,\u8BE6\u60C5\u3010\u63A7\u5236\u53F0\u4FE1\u606F\u3011",icon:"none",duration:3e3}),console.warn(s.message)):(this.getImageCaptcha(),this.captcha="",e.index.showToast({title:s.message,icon:"none"}))})},getCode(){if(this.reverseNumber==0){clearTimeout(this.reverseTimer),this.reverseTimer=null;return}this.reverseNumber--,this.reverseTimer=setTimeout(()=>{this.getCode()},1e3)}}};if(!Array){const t=e.resolveComponent("uni-captcha"),n=e.resolveComponent("uni-easyinput");(t+n)()}const p=()=>"../../../uni-captcha/components/uni-captcha/uni-captcha.js",h=()=>"../../../uni-easyinput/components/uni-easyinput/uni-easyinput.js";Math||(p+h)();function m(t,n,s,a,o,r){return{a:e.sr("captcha","311d2b6f-0"),b:e.o(i=>o.captcha=i),c:e.p({focus:s.focusCaptchaInput,scene:"send-sms-code",modelValue:o.captcha}),d:e.o(i=>o.focusSmsCodeInput=!1),e:e.o(i=>o.modelValue=i),f:e.p({focus:o.focusSmsCodeInput,type:"number",inputBorder:!1,maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u77ED\u4FE1\u9A8C\u8BC1\u7801",modelValue:o.modelValue}),g:e.t(r.innerText),h:e.n(o.reverseNumber==0?"inner-text-active":""),i:e.o((...i)=>t.start&&t.start(...i))}}var l=e._export_sfc(c,[["render",m],["__scopeId","data-v-311d2b6f"],["__file","C:/Users/yzc/Desktop/pet/uni_modules/uni-id-pages/components/uni-id-pages-sms-form/uni-id-pages-sms-form.vue"]]);wx.createComponent(l);
