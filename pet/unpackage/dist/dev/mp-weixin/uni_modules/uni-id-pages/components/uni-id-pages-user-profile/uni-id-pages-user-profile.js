"use strict";var e=require("../../../../common/vendor.js");const l=e.pn.database(),m=l.collection("uni-id-users");let d="";const f={emits:["next"],data(){return{}},methods:{async open(o){d=o,this.$refs.popup.open()},async getUserProfile(){e.index.showLoading();let o=await new Promise(p=>{e.index.getUserProfile({desc:"\u7528\u4E8E\u8BBE\u7F6E\u8D26\u6237\u6635\u79F0\u548C\u5934\u50CF",complete:s=>{console.log("getUserProfile:",s),p(s)}})});if(o.errMsg!="getUserProfile:ok")return this.closeMe();let{avatarUrl:i,nickName:t}=o.userInfo,r=await new Promise(p=>{e.index.downloadFile({url:i,success:s=>{s.statusCode===200&&p(s.tempFilePath),p()},fail:s=>{console.error(s)},complete:s=>{}})});const c=r.split(".").pop()||"jpg",n="user/avatar/"+d+"/"+Date.now()+"-avatar."+c,a=await e.pn.uploadFile({filePath:r,cloudPath:n,fileType:"image"});let u={nickname:t,avatar_file:{name:n,extname:"jpg",url:a.fileID}};this.doUpdate(u,()=>{this.$refs.popup.close()})},closeMe(o){e.index.showLoading(),this.doUpdate({nickname:"\u533F\u540D\u5FAE\u4FE1\u7528\u6237"},()=>{e.index.hideLoading(),this.$refs.popup.close()})},doUpdate(o,i){m.where("_id==$env.uid").update(o).then(t=>{i(t)}).catch(t=>{e.index.showModal({content:t.message||"\u8BF7\u6C42\u670D\u52A1\u5931\u8D25",showCancel:!1}),i(t)}).finally(()=>{this.$emit("next"),e.index.hideLoading()})}}};Array||e.resolveComponent("uni-popup")();const _=()=>"../../../uni-popup/components/uni-popup/uni-popup.js";Math||_();function h(o,i,t,r,c,n){return{a:e.o((...a)=>n.closeMe&&n.closeMe(...a)),b:e.o((...a)=>n.getUserProfile&&n.getUserProfile(...a)),c:e.sr("popup","5bfce60d-0"),d:e.p({type:"bottom"})}}var g=e._export_sfc(f,[["render",h],["__scopeId","data-v-5bfce60d"],["__file","C:/Users/yzc/Desktop/pet/uni_modules/uni-id-pages/components/uni-id-pages-user-profile/uni-id-pages-user-profile.vue"]]);wx.createComponent(g);
