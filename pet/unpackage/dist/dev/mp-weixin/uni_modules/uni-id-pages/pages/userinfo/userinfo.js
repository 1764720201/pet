"use strict";var e=require("../../../../common/vendor.js");const u=()=>"../../../../components/gtc-pickerAddress/pickerAddress.js",l=()=>"../../../../components/Issue/index.js",g=e.pn.database(),d=g.collection("uni-id-users");e.pn.importObject("uni-id-co");const h={components:{pickerAddress:u,Issue:l},data(){const t=this.getDate({format:!0});return{userInfo:{nickname:"",gender:0,city:["\u8BF7\u9009\u62E9\u57CE\u5E02"],introduction:"",birthday:"\u8BF7\u9009\u62E9\u65E5\u671F",wxcode:""},introuctionLength:0,genderList:[{text:"\u7537\u751F",value:1},{text:"\u5973\u751F",value:2}],hasLogin:!1,date:t}},async onLoad(){this.getUserInfo()},methods:{getDate(t){const o=new Date;let s=o.getFullYear()-20,a=o.getMonth()+1,n=o.getDate();return t==="start"?s=s-60:t==="end"&&(s=s+2),a=a>9?a:"0"+a,n=n>9?n:"0"+n,`${s}-${a}-${n}`},bindDateChange(t){this.userInfo.birthday=t.detail.value},change(t){this.userInfo.city=t.data},login(){e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd",complete:t=>{console.log(t)}})},getUserInfo(t){e.index.showLoading({mask:!0}),d.where("'_id' == $cloudEnv_uid").field("mobile,nickname,city,introduction,birthday,gender,wxcode").get().then(o=>{console.log(o.result.data[0]);const s=o.result.data[0];this.userInfo=Object.assign(this.userInfo,JSON.parse(JSON.stringify(s))),this.hasLogin=!0}).catch(o=>{this.userInfo={},this.hasLogin=!1,console.log(o.message,o.errCode)}).finally(o=>{e.index.hideLoading()})},saveAmend(){d.where("_id==$env.uid").update({nickname:this.userInfo.nickname,gender:this.userInfo.gender,birthday:this.userInfo.birthday,introduction:this.userInfo.introduction,city:this.userInfo.city,wxcode:this.userInfo.wxcode}).then(t=>{console.log(t),t.result.updated?(e.index.showToast({title:"\u66F4\u65B0\u6210\u529F",icon:"none"}),setTimeout(()=>{e.index.navigateBack()},300)):e.index.showToast({title:"\u6CA1\u6709\u6539\u53D8",icon:"none"})}).catch(t=>{console.log(t)})}},computed:{startDate(){return this.getDate("start")},endDate(){return this.getDate("end")}},watch:{userInfo:{handler(t,o){this.introuctionLength=o.introduction.length},deep:!0}}};if(!Array){const t=e.resolveComponent("uni-id-pages-avatar"),o=e.resolveComponent("uni-data-checkbox"),s=e.resolveComponent("pickerAddress"),a=e.resolveComponent("Issue"),n=e.resolveComponent("uni-id-pages-bind-mobile");(t+o+s+a+n)()}const m=()=>"../../components/uni-id-pages-avatar/uni-id-pages-avatar.js",_=()=>"../../../uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js",p=()=>"../../components/uni-id-pages-bind-mobile/uni-id-pages-bind-mobile.js";Math||(m+_+p)();function f(t,o,s,a,n,r){var c;return{a:e.p({width:"260rpx",height:"260rpx"}),b:n.userInfo.nickname,c:e.o(i=>n.userInfo.nickname=i.detail.value),d:e.o(i=>n.userInfo.gender=i),e:e.p({mode:"tag",localdata:n.genderList,modelValue:n.userInfo.gender}),f:e.t(n.userInfo.birthday),g:n.date,h:r.startDate,i:r.endDate,j:e.o((...i)=>r.bindDateChange&&r.bindDateChange(...i)),k:e.t((c=n.userInfo)==null?void 0:c.city.join("")),l:e.o(r.change),m:n.userInfo.wxcode,n:e.o(i=>n.userInfo.wxcode=i.detail.value),o:n.userInfo.introduction,p:e.o(i=>n.userInfo.introduction=i.detail.value),q:e.t(n.introuctionLength),r:e.o(r.saveAmend),s:e.p({issue:"\u4FDD\u5B58\u4FEE\u6539"}),t:e.sr("bind-mobile-by-sms","451985ee-4"),v:e.o(r.getUserInfo)}}var b=e._export_sfc(h,[["render",f],["__scopeId","data-v-451985ee"],["__file","C:/Users/yzc/Desktop/pet/uni_modules/uni-id-pages/pages/userinfo/userinfo.vue"]]);wx.createPage(b);
