"use strict";var u=require("../../../common/vendor.js");if(!Array){const y=u.resolveComponent("uni-forms-item"),a=u.resolveComponent("uni-easyinput"),l=u.resolveComponent("uni-file-picker"),m=u.resolveComponent("uni-data-checkbox"),o=u.resolveComponent("uni-icons"),r=u.resolveComponent("uni-forms");(y+a+l+m+o+r)()}const E=()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",h=()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js",D=()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",w=()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js",A=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",C=()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(E+h+D+w+I+A+C+F)();const F=()=>"../../../components/Issue/index.js",I=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",B=u.defineComponent({__name:"index",setup(y){const a=u.reactive({uid:0}),l=u.reactive({width:74,height:74,border:{color:"#afafaf",radio:10}}),m=n=>{e.city=n.data};u.onShow(()=>{Object.assign(a,u.pn.getCurrentUserInfo())});const o=u.ref(),r=u.ref(),f=n=>n.map(i=>i.text);u.onLoad(n=>{n.id?(o.value=!0,r.value=n.id):o.value=!1,Object.assign(a,u.pn.getCurrentUserInfo()),a.uid?(_.collection("uni-id-users").where(`_id=='${a.uid}'`).field("mobile as phone,wxcode as wxCode,city").get({getOne:!0}).then(i=>{const t=i.result.data;t.city==["\u8BF7\u9009\u62E9\u57CE\u5E02"]&&t.city==e.city,Object.assign(e,t)}),o.value&&_.collection("foundPet").where(`_id=='${r.value}'&&user_id=='${a.uid}'`).get({getOne:!0}).then(i=>{const t=i.result.data;e.city=t.city,e.title=t.title,e.introduce=t.introduce,e.uploadPicture=t.uploadPicture,e.variety=t.variety,e.name=t.name,e.phone=t.phone,e.wxCode=t.wx_code,e.reward=t.reward,e.typeIndex=x[0].indexOf(t.type),e.starIndex=x[1].indexOf(t.star),e.genderIndex=x[2].indexOf(t.gender)})):u.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})});const e=u.reactive({city:["\u6D59\u6C5F\u7701","\u5B81\u6CE2\u5E02","\u5B81\u6D77\u53BF"],name:"",introduce:"",title:"",uploadPicture:[],wxCode:"",phone:"",reward:"",typeIndex:0,starIndex:0,genderIndex:0,variety:""}),v=u.reactive({title:{rules:[{required:!0,errorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"}]},variety:{rules:[{required:!0,errorMessage:"\u54C1\u79CD\u4E0D\u80FD\u4E3A\u7A7A"}]},uploadPicture:{rules:[{required:!0,errorMessage:"\u56FE\u7247\u4E0D\u80FD\u4E3A\u7A7A"}]},name:{rules:[{required:!0,errorMessage:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]},wxCode:{rules:[{required:!0,errorMessage:"\u5FAE\u4FE1\u53F7\u4E0D\u80FD\u4E3A\u7A7A"}]},introduce:{rules:[{required:!0,errorMessage:"\u4ECB\u7ECD\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:200,errorMessage:"\u6700\u5927\u957F\u5EA6\u4E3A200"}]},phone:{rules:[{required:!0,errorMessage:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{format:"number",errorMessage:"\u624B\u673A\u53F7\u5FC5\u987B\u4E3A\u6570\u5B57"}]}}),p=u.ref(null),_=u.pn.database(),g=async()=>{o.value?p.value.validate().then(()=>{_.collection("foundPet").where(`_id=='${r.value}'&&user_id=='${a.uid}'`).update({type:s[e.typeIndex].text,uploadPicture:e.uploadPicture,name:e.name,star:d[e.starIndex].text,variety:e.variety,gender:c[e.genderIndex].text,introduce:e.introduce,title:e.title,city:e.city,phone:e.phone,wx_code:e.wxCode,reward:e.reward}).then(()=>{u.index.showToast({title:"\u4FEE\u6539\u6210\u529F",icon:"none",success(){setTimeout(()=>{u.index.navigateBack()},500)}})})}):p.value.validate().then(()=>{u.pn.callFunction({name:"foundPet",data:{type:s[e.typeIndex].text,imageList:e.uploadPicture,name:e.name,star:d[e.starIndex].text,variety:e.variety,gender:c[e.genderIndex].text,introduce:e.introduce,title:e.title,city:e.city,phone:e.phone,wxCode:e.wxCode,reward:e.reward,avatarURL:e.avatarURL,authorName:e.authorName,state:"\u5DF2\u53D1\u5E03"},success(){u.index.showToast({title:"\u53D1\u5E03\u6210\u529F"})},fail(n){console.log(n)}})}).then(()=>{u.index.navigateBack()}).catch(n=>{console.log(n)})},s=u.reactive([{text:"\u5BFB\u5BA0",value:0},{text:"\u5BFB\u4E3B",value:1}]),d=u.reactive([{text:"\u6C6A\u661F\u4EBA",value:0},{text:"\u55B5\u661F\u4EBA",value:1},{text:"\u5176\u4ED6",value:2}]),c=u.reactive([{text:"\u7537\u751F",value:0},{text:"\u5973\u751F",value:1}]),x=[s,d,c].map(n=>f(n));return(n,i)=>({a:e.title,b:u.o(t=>e.title=t.detail.value),c:u.p({name:"title"}),d:u.o(t=>e.introduce=t),e:u.p({type:"textarea",cols:"40",rows:"5",placeholder:"\u5B9D\u8D1D\u7279\u5F81\u4ECB\u7ECD~",modelValue:e.introduce}),f:u.p({name:"introduce"}),g:u.o(t=>e.uploadPicture=t),h:u.p({limit:"3",["file-mediatype"]:"image",mode:"grid",imageStyles:l,modelValue:e.uploadPicture}),i:u.p({name:"uploadPicture"}),j:u.o(t=>e.typeIndex=t),k:u.p({mode:"tag",localdata:s,modelValue:e.typeIndex}),l:u.p({label:"\u7C7B\u578B",name:"type"}),m:e.variety,n:u.o(t=>e.variety=t.detail.value),o:u.p({label:"\u54C1\u79CD",name:"variety"}),p:e.name,q:u.o(t=>e.name=t.detail.value),r:u.p({label:"\u59D3\u540D",name:"name"}),s:e.phone,t:u.o(t=>e.phone=t.detail.value),v:u.p({label:"\u7535\u8BDD",name:"phone"}),w:e.wxCode,x:u.o(t=>e.wxCode=t.detail.value),y:u.p({label:"\u5FAE\u4FE1\u53F7",name:"wxCode"}),z:u.t(e.city.join("")),A:u.o(m),B:u.p({type:"right",size:"20"}),C:u.p({label:"\u8D70\u5931\u57CE\u5E02",name:"city"}),D:u.o(t=>e.starIndex=t),E:u.p({mode:"tag",localdata:d,modelValue:e.starIndex}),F:u.p({label:"\u4E22\u4E86\u4EC0\u4E48",name:"star"}),G:u.o(t=>e.genderIndex=t),H:u.p({mode:"tag",localdata:c,modelValue:e.genderIndex}),I:u.p({label:"\u6027\u522B",name:"gender"}),J:e.reward,K:u.o(t=>e.reward=t.detail.value),L:u.p({label:"\u60AC\u8D4F\u91D1\u989D",name:"reward"}),M:u.sr(p,"3fdeabaf-0",{k:"form"}),N:u.p({modelValue:e,["label-width"]:"150",rules:v}),O:u.o(g),P:u.p({issue:"\u786E\u8BA4\u53D1\u5E03"})})}});var b=u._export_sfc(B,[["__scopeId","data-v-3fdeabaf"],["__file","C:/Users/yzc/Desktop/pet/pages/Issue/FoundPet/index.vue"]]);wx.createPage(b);
