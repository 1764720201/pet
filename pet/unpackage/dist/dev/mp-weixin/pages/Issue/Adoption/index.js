"use strict";var u=require("../../../common/vendor.js");if(!Array){const F=u.resolveComponent("uni-file-picker"),r=u.resolveComponent("uni-forms-item"),n=u.resolveComponent("uni-data-checkbox"),i=u.resolveComponent("uni-data-select"),A=u.resolveComponent("uni-icons"),g=u.resolveComponent("uni-forms");(F+r+n+i+A+g)()}const k=()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",L=()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",M=()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js",j=()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js",N=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",P=()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(k+L+M+j+V+N+P+O)();const V=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",O=()=>"../../../components/Issue/index.js",$=u.defineComponent({__name:"index",setup(F){const r=u.ref(),n=u.pn.database(),i=u.ref(!1),A=async()=>{await n.collection("uni-id-users").where("_id==$cloudEnv_uid").get({getOne:!0}).then(a=>{r.value=a.result.data._id,i.value=!0}).catch(()=>{i.value=!1})};u.onShow(async()=>{await A(),i.value||u.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"}),await n.collection("uni-id-users").where(`_id=='${r.value}'`).field("nickname as name,mobile as phone,wxcode as wxCode,city").get({getOne:!0}).then(a=>{const o=a.result.data;o.city[0]=="\u8BF7\u9009\u62E9\u57CE\u5E02"&&o.city==e.city,Object.assign(e,o)})});const g=u.reactive({width:74,height:74,border:{color:"#afafaf",radio:10}}),w=a=>{e.city=a.data},c=u.ref(),_=u.ref();u.onLoad(a=>{a.id?(c.value=!0,_.value=a.id):c.value=!1,c.value&&n.collection("adoption").where(`_id=='${_.value}'&&user_id=='${r.value}'`).get({getOne:!0}).then(o=>{const t=o.result.data;e.uploadPicture=t.img,e.video=t.video,e.city=t.city,e.phone=t.phone,e.wxCode=t.wx_code,e.variety=t.variety,e.petName=t.pet_name,e.story=t.story,e.starIndex=s[5].indexOf(t.star),e.genderIndex=s[4].indexOf(t.gender),e.punchIndex=s[0].indexOf(t.punch),e.age=s[2].indexOf(t.age),e.medical=d(t.medical,1),e.source=d(t.source,3),e.request=d(t.request,6),e.particular=d(t.particular,7)})});const b=a=>a.map(o=>o.text),d=(a,o)=>a.map(t=>s[o].indexOf(t)),D=u.ref(null),I=u.reactive({petName:{rules:[{required:!0,errorMessage:"\u5BA0\u7269\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:5,errorMessage:"\u5BA0\u7269\u540D\u6700\u591A5\u4E2A\u5B57"}]},name:{rules:[{required:!0,errorMessage:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]},wxCode:{rules:[{required:!0,errorMessage:"\u5FAE\u4FE1\u53F7\u4E0D\u80FD\u4E3A\u7A7A"}]},request:{rules:[{required:!0,errorMessage:"\u9886\u517B\u8981\u6C42\u4E0D\u80FD\u4E3A\u7A7A"}]},source:{rules:[{required:!0,errorMessage:"\u6765\u6E90\u4E0D\u80FD\u4E3A\u7A7A"}]},medical:{rules:[{required:!0,errorMessage:"\u533B\u7597\u4E0D\u80FD\u4E3A\u7A7A"}]},uploadPicture:{rules:[{required:!0,errorMessage:"\u56FE\u7247\u4E0D\u80FD\u4E3A\u7A7A"}]},story:{rules:[{required:!0,errorMessage:"\u5B9D\u8D1D\u6545\u4E8B\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:200,errorMessage:"\u5B57\u6570\u6700\u591A200"}]},variety:{rules:[{required:!0,errorMessage:"\u54C1\u79CD\u4E0D\u80FD\u4E3A\u7A7A"}]},age:{rules:[{required:!0,errorMessage:"\u5E74\u9F84\u4E0D\u80FD\u4E3A\u7A7A"}]},city:{rules:[{required:!0,errorMessage:"\u57CE\u5E02\u4E0D\u80FD\u4E3A\u7A7A"}]},phone:{rules:[{required:!0,errorMessage:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{format:"number",errorMessage:"\u624B\u673A\u53F7\u5FC5\u987B\u4E3A\u6570\u5B57"}]}}),e=u.reactive({story:"",name:"",variety:"",phone:"",city:["\u6D59\u6C5F\u7701","\u5B81\u6CE2\u5E02","\u5B81\u6D77\u53BF"],petName:"",genderIndex:0,punchIndex:0,age:0,wxCode:"",uploadPicture:[],medical:[],source:[],request:[],particular:[],starIndex:1,video:[]}),m=u.reactive([{text:"\u6C6A\u661F\u4EBA",value:0},{text:"\u55B5\u661F\u4EBA",value:1},{text:"\u5176\u4ED6",value:2}]),p=u.reactive([{text:"\u7537\u751F",value:0},{text:"\u5973\u751F",value:1}]),h=u.reactive([{text:"\u5DF2\u7EDD\u80B2",value:0},{text:"\u5DF2\u514D\u75AB",value:1},{text:"\u5DF2\u9A71\u866B",value:2}]),f=u.reactive([{text:"\u5BB6\u517B",value:0},{text:"\u4E2A\u4EBA\u6C42\u52A9",value:1},{text:"\u6D41\u6D6A\u57FA\u5730",value:2}]),v=u.reactive([{text:"\u4E0D\u6EE11\u4E2A\u6708",value:0},{text:"1\u4E2A\u6708",value:1},{text:"2\u4E2A\u6708",value:2},{text:"3-6\u4E2A\u6708",value:3},{text:"6\u4E2A\u6708-1\u5C81",value:4},{text:"1\u5C81",value:5},{text:"2\u5C81",value:6},{text:"3\u5C81\u53CA\u4EE5\u4E0A",value:7}]),y=u.reactive([{text:"\u9AD8\u51B7",value:0},{text:"\u7C98\u4EBA",value:1},{text:"\u94C1\u61A8\u61A8",value:2},{text:"\u751C\u7F8E",value:3},{text:"\u6E29\u6587\u5C14\u96C5",value:4},{text:"\u4E56\u5DE7",value:5},{text:"\u8D2A\u73A9",value:6},{text:"\u80C6\u5C0F",value:7},{text:"\u53DB\u9006",value:8},{text:"\u61D2\u60F0",value:9},{text:"\u65E0\u653B\u51FB\u6027",value:10},{text:"\u4E0D\u6311\u98DF",value:11},{text:"\u4E0D\u4E71\u53EB",value:12},{text:"\u8BB2\u536B\u751F",value:13}]),B=u.reactive([{text:"\u4EC5\u9650\u540C\u57CE",value:0},{text:"\u63A5\u53D7\u56DE\u8BBF",value:1},{text:"\u7B7E\u8BA2\u534F\u8BAE",value:2},{text:"\u7EDD\u80B2",value:3},{text:"\u5B89\u88C5\u7EB1\u7A97",value:4},{text:"\u529E\u7406\u72D7\u8BC1",value:5},{text:"\u51FA\u95E8\u7275\u7EF3",value:6}]),x=u.reactive([{text:"\u4E0D\u9700\u8981\u6253\u5361",value:0},{text:"4\u5468",value:1},{text:"5\u5468",value:2},{text:"8\u5468",value:3},{text:"12\u5468",value:4},{text:"16\u5468",value:5}]),s=[x,h,v,f,p,m,B,y].map(a=>b(a)),E=(a,o)=>a.map(t=>o[t].text),q=()=>{const a=E(e.medical,h),o=E(e.source,f),t=E(e.particular,y),C=E(e.request,B);c.value?D.value.validate().then(()=>{n.collection("adoption").where(`_id=='${_.value}'&&user_id=='${r.value}'`).update({img:e.uploadPicture,pet_name:e.petName,star:m[e.starIndex].text,variety:e.variety,gender:p[e.genderIndex].text,age:v[e.age].text,medical:a,source:o,particular:t,story:e.story,request:C,punch:x[e.punchIndex].text,name:e.name,city:e.city,phone:e.phone,wx_code:e.wxCode}).then(()=>{u.index.showToast({title:"\u4FEE\u6539\u6210\u529F",icon:"none",success(){setTimeout(()=>{u.index.navigateBack()},500)}})}).catch(l=>{console.log(l)})}):D.value.validate().then(()=>{u.pn.callFunction({name:"adoption",data:{user_id:r.value,imageList:e.uploadPicture,petName:e.petName,star:m[e.starIndex].text,variety:e.variety,gender:p[e.genderIndex].text,age:v[e.age].text,medicalList:a,source:o,particularList:t,story:e.story,requestList:C,punch:x[e.punchIndex].text,name:e.name,city:e.city,phone:e.phone,wx_code:e.wxCode,video:e.video,ifAdopt:!1},success(){u.index.showToast({title:"\u53D1\u5E03\u6210\u529F"})},fail(l){console.log(l)}})}).then(()=>{u.index.navigateBack()}).catch(l=>{console.log(l)})};return(a,o)=>({a:u.o(t=>e.uploadPicture=t),b:u.p({limit:"3",["file-mediatype"]:"image",mode:"grid",imageStyles:g,modelValue:e.uploadPicture}),c:u.p({name:"uploadPicture"}),d:u.o(t=>e.video=t),e:u.p({limit:"1",["file-mediatype"]:"video",modelValue:e.video}),f:e.petName,g:u.o(t=>e.petName=t.detail.value),h:u.p({label:"\u5BA0\u7269\u6635\u79F0",name:"petName"}),i:u.o(t=>e.starIndex=t),j:u.p({mode:"tag",localdata:m,modelValue:e.starIndex}),k:u.p({label:"\u661F\u7403",name:"star"}),l:e.variety,m:u.o(t=>e.variety=t.detail.value),n:u.p({label:"\u54C1\u79CD",name:"variety"}),o:u.o(t=>e.genderIndex=t),p:u.p({mode:"tag",localdata:p,modelValue:e.genderIndex}),q:u.p({label:"\u6027\u522B",name:"gender"}),r:u.o(t=>e.age=t),s:u.p({localdata:v,modelValue:e.age}),t:u.p({label:"\u5E74\u9F84",name:"age"}),v:u.o(t=>e.medical=t),w:u.p({mode:"tag",multiple:!0,localdata:h,modelValue:e.medical}),x:u.p({label:"\u533B\u7597",name:"medical"}),y:u.o(t=>e.source=t),z:u.p({mode:"tag",multiple:!0,localdata:f,modelValue:e.source}),A:u.p({label:"\u5BA0\u7269\u6765\u6E90",name:"source"}),B:u.o(t=>e.particular=t),C:u.p({mode:"tag",multiple:!0,localdata:y,max:"3",modelValue:e.particular}),D:u.p({name:"particular"}),E:e.story,F:u.o(t=>e.story=t.detail.value),G:u.p({name:"story"}),H:u.o(t=>e.request=t),I:u.p({mode:"tag",multiple:!0,localdata:B,modelValue:e.request}),J:u.p({name:"request"}),K:u.o(t=>e.punchIndex=t),L:u.p({localdata:x,clear:!1,modelValue:e.punchIndex}),M:u.p({label:"\u9001\u517B\u6210\u529F\u540E,\u8981\u6C42\u9886\u517B\u4EBA\u6253\u5361",name:"punch"}),N:e.name,O:u.o(t=>e.name=t.detail.value),P:u.p({label:"\u59D3\u540D",name:"name"}),Q:u.t(e.city.join("")),R:u.o(w),S:u.p({type:"right",size:"20"}),T:u.p({label:"\u6240\u5728\u57CE\u5E02",name:"city"}),U:e.phone,V:u.o(t=>e.phone=t.detail.value),W:u.p({label:"\u624B\u673A\u53F7",name:"phone"}),X:e.wxCode,Y:u.o(t=>e.wxCode=t.detail.value),Z:u.p({label:"\u5FAE\u4FE1\u53F7",name:"wxCode"}),aa:u.sr(D,"d77e4bec-0",{k:"form"}),ab:u.p({rules:I,["label-width"]:"150",modelValue:e}),ac:u.o(q),ad:u.p({issue:"\u786E\u8BA4\u53D1\u5E03"})})}});var T=u._export_sfc($,[["__scopeId","data-v-d77e4bec"],["__file","C:/Users/yzc/Desktop/pet/pages/Issue/Adoption/index.vue"]]);wx.createPage(T);
