"use strict";var e=require("../../../common/vendor.js");if(!Array){const E=e.resolveComponent("uni-data-checkbox"),o=e.resolveComponent("uni-forms-item"),a=e.resolveComponent("uni-icons"),i=e.resolveComponent("uni-forms");(E+o+a+i)()}const D=()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js",L=()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",M=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",O=()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(D+L+M+j+O)();const j=()=>"../../../components/gtc-pickerAddress/pickerAddress.js",$=e.defineComponent({__name:"index",setup(E){const o=e.ref(5),a=e.ref(0),i=e.ref(2),y=e.reactive({phone:{rules:[{required:!0,errorMessage:"\u624B\u673A\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:"^\\+?[0-9-]{3,20}$",errorMessage:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"}]},city:{rules:[{required:!0,errorMessage:"\u8BF7\u9009\u62E9\u6240\u5728\u7684\u57CE\u5E02"}]},work:{rules:[{required:!0,errorMessage:"\u8BF7\u8F93\u5165\u804C\u4E1A"}]},wxCode:{rules:[{required:!0,errorMessage:"\u8BF7\u8F93\u5165\u5FAE\u4FE1\u53F7"}]}}),f=n=>{o.value=n.detail.value,t.age=r[n.detail.value]},I=n=>{a.value=n.detail.value,t.house=c[n.detail.value]},F=n=>{i.value=n.detail.value,t.income=d[n.detail.value]},l=e.reactive([{value:0,text:"\u5973\u94F2\u5C4E\u5B98"},{value:1,text:"\u7537\u94F2\u5C4E\u5B98"}]),p=e.reactive([{value:0,text:"\u6709"},{value:1,text:"\u65E0"}]),x=e.reactive([{value:0,text:"\u6709\u732B"},{value:1,text:"\u6709\u72D7"},{value:2,text:"\u732B\u72D7"},{value:3,text:"\u65E0"}]),m=e.reactive([{value:0,text:"\u5355\u8EAB"},{value:1,text:"\u604B\u7231"},{value:2,text:"\u5DF2\u5A5A"}]),r=["40\u540E","50\u540E","60\u540E","70\u540E","80\u540E","90\u540E","00\u540E","10\u540E"],c=["\u81EA\u6709\u4F4F\u623F","\u6574\u79DF","\u5408\u79DF","\u5176\u4ED6"],d=["\u5C0F\u4E8E3\u5343","3-6\u5343","6\u5343-1\u4E07","\u4E00\u4E07\u4EE5\u4E0A"],t=e.reactive({adoptId:"",age:r[o.value],genderIndex:0,experienceIndex:0,presentIndex:0,house:c[a.value],marriageIndex:0,income:d[i.value],work:"",city:["\u6D59\u6C5F\u7701","\u5B81\u6CE2\u5E02","\u5B81\u6D77\u53BF"],phone:"",wxCode:"",sincerity:"",state:""}),g=e.pn.database(),v=e.ref(!1),w=l.map(n=>n.text),A=n=>{t.city=n.data},B=p.map(n=>n.text),C=m.map(n=>n.text),b=x.map(n=>n.text),_=e.pn.getCurrentUserInfo().uid;e.onLoad(async n=>{n.adoptId&&(t.adoptId=n.adoptId),await g.collection("apply").where(`adopt_id=='${t.adoptId}'&&user_id=='${_}'&&state=='\u7533\u8BF7\u4E2D'`).get().then(s=>{s.result.data[0]?v.value=!0:v.value=!1}).then(()=>{g.collection("uni-id-users").where("_id==$cloudEnv_uid").field("mobile as phone,wxcode as wxCode,city").get({getOne:!0}).then(s=>{const u=s.result.data;u.city[0]=="\u8BF7\u9009\u62E9\u57CE\u5E02"&&u.city==t.city,Object.assign(t,u)})}).then(()=>{v.value&&g.collection("apply").where(`adopt_id=='${t.adoptId}'&&user_id=='${_}'`).get({getone:!0}).then(s=>{const u=s.result.data;t.sincerity=u.sincerity,t.work=u.work,t.phone=u.phone,o.value=r.indexOf(u.age),a.value=c.indexOf(u.house),i.value=d.indexOf(u.income),t.wxCode=u.wx_code,t.genderIndex=w.indexOf(u.gender),t.city=u.city,t.experienceIndex=B.indexOf(u.experience),t.marriageIndex=C.indexOf(u.marriage),t.presentIndex=b.indexOf(u.present)})})});const h=e.ref(null),k=async()=>{v.value?h.value.validate().then(()=>{g.collection("apply").where(`adopt_id=='${t.adoptId}'&&user_id=='${_}'`).update({adopt_id:t.adoptId,age:t.age,gender:l[t.genderIndex].text,experience:p[t.experienceIndex].text,present:x[t.presentIndex].text,house:t.house,marriage:m[t.marriageIndex].text,income:t.income,work:t.work,city:t.city,phone:t.phone,wx_code:t.wxCode,sincerity:t.sincerity,state:"\u7533\u8BF7\u4E2D"})}).then(()=>{e.index.showToast({title:"\u7F16\u8F91\u6210\u529F",icon:"none",success(){setTimeout(()=>{e.index.navigateBack()},500)}})}):await h.value.validate().then(()=>{e.pn.callFunction({name:"apply",data:{adoptId:t.adoptId,age:t.age,gender:l[t.genderIndex].text,experience:p[t.experienceIndex].text,present:x[t.presentIndex].text,house:t.house,marriage:m[t.marriageIndex].text,income:t.income,work:t.work,city:t.city,phone:t.phone,wxCode:t.wxCode,sincerity:t.sincerity,state:"\u7533\u8BF7\u4E2D"},success(){setTimeout(()=>{e.index.redirectTo({url:"/pages/Mine/Request/Apply/index",success(){e.index.showToast({title:"\u7533\u8BF7\u6210\u529F"})}})},300)},fail(n){console.log(n)}})}).catch(n=>{console.log(n)})};return(n,s)=>({a:e.o(u=>t.genderIndex=u),b:e.p({mode:"tag",localdata:l,modelValue:t.genderIndex}),c:e.p({name:"genderIndex",label:"\u6027\u522B"}),d:e.t(r[o.value]),e:e.p({type:"right",size:"23",color:"#ccc"}),f:e.o(f),g:o.value,h:r,i:e.p({name:"age",label:"\u5E74\u9F84"}),j:e.o(u=>t.experienceIndex=u),k:e.p({mode:"tag",localdata:p,modelValue:t.experienceIndex}),l:e.p({name:"experienceIndex",label:"\u517B\u5BA0\u7ECF\u9A8C"}),m:e.o(u=>t.presentIndex=u),n:e.p({mode:"tag",localdata:x,modelValue:t.presentIndex}),o:e.p({name:"presentIndex",label:"\u76EE\u524D\u5BA0\u7269"}),p:e.t(c[a.value]),q:e.p({type:"right",size:"23",color:"#ccc"}),r:e.o(I),s:a.value,t:c,v:e.p({name:"house",label:"\u4F4F\u623F\u60C5\u51B5"}),w:e.o(u=>t.marriageIndex=u),x:e.p({mode:"tag",localdata:m,modelValue:t.marriageIndex}),y:e.p({name:"marriageIndex",label:"\u5A5A\u59FB\u72B6\u51B5"}),z:e.t(d[i.value]),A:e.p({type:"right",size:"23",color:"#ccc"}),B:e.o(F),C:i.value,D:d,E:e.p({name:"income",label:"\u6708\u6536\u5165"}),F:t.work,G:e.o(u=>t.work=u.detail.value),H:e.p({name:"work",label:"\u804C\u4E1A"}),I:e.t(t.city.join("")),J:e.o(A),K:e.p({type:"right",size:"20"}),L:e.p({label:"\u6240\u5728\u57CE\u5E02",name:"city"}),M:t.phone,N:e.o(u=>t.phone=u.detail.value),O:e.p({name:"phone",label:"\u624B\u673A\u53F7"}),P:t.wxCode,Q:e.o(u=>t.wxCode=u.detail.value),R:e.p({name:"wxCode",label:"\u5FAE\u4FE1\u53F7"}),S:t.sincerity,T:e.o(u=>t.sincerity=u.detail.value),U:e.p({name:"sincerity"}),V:e.o(k),W:e.sr(h,"0025aefd-0",{k:"form"}),X:e.p({model:t,["label-width"]:100,rules:y})})}});var q=e._export_sfc($,[["__scopeId","data-v-0025aefd"],["__file","C:/Users/yzc/Desktop/pet/pages/ApplyAdopt/Apply/index.vue"]]);wx.createPage(q);
