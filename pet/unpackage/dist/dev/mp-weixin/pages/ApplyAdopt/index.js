"use strict";var e=require("../../common/vendor.js"),k=require("../../common/throttle.js");if(!Array){const _=e.resolveComponent("uni-popup-dialog"),i=e.resolveComponent("uni-popup");(_+i)()}const B=()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js",$=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(b+D+L+E+T+P+q+B+$+U)();const D=()=>"./PetInformation/index.js",T=()=>"../../components/AuthorInformation/index.js",b=()=>"./PetAppearance/index.js",E=()=>"./Applied/index.js",P=()=>"./Explain/index.js",U=()=>"./Inferior/index.js",L=()=>"./Remind/index.js",q=()=>"../../components/Message/index.js",M=e.defineComponent({__name:"index",setup(_){const i=e.ref("");e.onShow(()=>{i.value=e.pn.getCurrentUserInfo().uid});const c=e.pn.database(),u=e.ref([]),r=e.reactive({nickname:"",avatar_file:{url:""},_id:""}),d=e.reactive({nickname:"",avatar_file:{url:""},_id:""}),n=e.reactive({_id:"",age:"",city:[],gender:"",img:[],medical:[],name:"",particular:[],pet_name:"",phone:"",punch:"",request:[""],source:[""],story:"",variety:"",wx_code:"",issue_time:0,user_id:"",if_adopt:!1}),A=()=>{e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})},v=e.ref(""),g=e.ref(null),p=e.ref(),I=()=>{e.pn.callFunction({name:"comment",data:{comment:p.value,type:0,userId:i.value,adoptId:n._id,avatarUrl:d.avatar_file.url,nickname:d.nickname}}).then(()=>{p.value="",e.index.showToast({title:"\u8BC4\u8BBA\u6210\u529F"}),h()}).catch(t=>{console.log(t)})},F=()=>{i.value=e.pn.getCurrentUserInfo().uid,p.value?i.value?k.throttle(I(),3e3):g.value.open("center"):e.index.showToast({title:"\u8BF7\u8F93\u5165\u6587\u5B57",icon:"none"})},j=t=>{e.index.navigateTo({url:`/pages/ApplyAdopt/index?id=${t._id}`})},f=e.ref([]),h=async()=>{await c.collection("comment").where(`adopt_id=='${n._id}'&&comment_type==0`).orderBy("create_time","desc").get().then(t=>{f.value=t.result.data})},x=e.ref([]),y=async(t,a)=>{await c.collection("uni-id-users").where(t).field("nickname,avatar_file,_id").get({getOne:!0}).then(o=>{Object.assign(a,o.result.data)})};e.onLoad(async t=>{i.value=e.pn.getCurrentUserInfo().uid,await c.collection("adoption").where(`_id == '${t.id}'`).get().then(async a=>{await Object.assign(n,a.result.data[0]),v.value=`comment_type==1&&adopt_id=='${n._id}'`}).then(async()=>{l(),await y(`_id == '${i.value}'`,d),await y(`_id=='${n.user_id}'`,r),h()}).then(()=>{c.collection("apply").where(`adopt_id=='${n._id}'&&state=='\u7533\u8BF7\u4E2D'`).field("user_id").get().then(a=>{x.value=a.result.data})}).catch(a=>{console.log(a.code),console.log(a.message)})});const s=e.ref(0),m=e.ref(),l=()=>{c.collection("adoption").where(`city=='${n.city[1]}'&&_id!='${n._id}'`).field("pet_name as petName,_id,img").skip(s.value).limit(3).get({getCount:!0}).then(t=>{u.value=t.result.data,m.value=t.result.count})},C=()=>{s.value>=m.value?(s.value=0,e.index.showToast({title:"\u6CA1\u6709\u66F4\u591A\u4E86",icon:"none"}),l()):s.value+3>=m.value?(s.value=0,e.index.showToast({title:"\u6CA1\u6709\u66F4\u591A\u4E86",icon:"none"}),l()):(s.value+=3,l())};return(t,a)=>e.e({a:e.p({petInfo:n}),b:e.p({petInfo:n}),c:e.p({applyList:x.value}),d:e.p({nickname:r.nickname,avatarUrl:r.avatar_file.url,userId:r._id,wxCode:n.wx_code,phone:n.phone,title:"\u9001\u517B\u4EBA\u4FE1\u606F"}),e:e.o(C),f:u.value},u.value?{g:e.f(u.value,(o,N,R)=>{var w;return{a:(w=o==null?void 0:o.img[0])==null?void 0:w.url,b:e.t(o.petName),c:o._id,d:e.o(z=>j(o),o._id)}})}:{},{h:!u.value[0]},u.value[0]?{}:{},{i:p.value,j:e.o(o=>p.value=o.detail.value),k:e.o(F),l:e.p({commentList:f.value,where:v.value}),m:e.o(A),n:e.p({type:"warn",cancelText:"\u6682\u4E0D\u767B\u5F55",confirmText:"\u524D\u5F80\u767B\u5F55",title:"\u63D0\u9192",content:"\u60A8\u8FD8\u672A\u767B\u5F55,\u662F\u5426\u8981\u524D\u5F80\u767B\u5F55"}),o:e.sr(g,"ba888104-7",{k:"alertDialog"}),p:e.p({type:"dialog"}),q:e.p({petInfo:n})})}});var O=e._export_sfc(M,[["__scopeId","data-v-ba888104"],["__file","C:/Users/yzc/Desktop/pet/pages/ApplyAdopt/index.vue"]]);wx.createPage(O);
