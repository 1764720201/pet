"use strict";var e=require("../../../common/vendor.js");if(!Array){const r=e.resolveComponent("tui-icon"),i=e.resolveComponent("uni-dateformat"),a=e.resolveComponent("uni-popup-dialog"),s=e.resolveComponent("uni-popup");(r+i+a+s)()}const w=()=>"../../../node-modules/thorui-uni/lib/thorui/tui-icon/tui-icon.js",x=()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",k=()=>"../../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js",F=()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(w+x+I+k+F)();const I=()=>"../../../components/Message/index.js",b=e.defineComponent({__name:"index",setup(r){const i=e.pn.database(),a=e.pn.getCurrentUserInfo().uid,s=e.ref(null),h=()=>{s.value.open("center")},g=n=>{e.pn.callFunction({name:"comment",data:{comment:n,type:0,userId:a,foundId:t._id,nickname:d.nickname,avatarUrl:d.avatar_file.url},success(){e.index.showToast({title:"\u8BC4\u8BBA\u6210\u529F"}),_()},fail(o){console.log(o)}})},d=e.reactive({avatar_file:{url:""},nickname:""}),t=e.reactive({_id:"",variety:"",name:"",gender:"",type:"",city:[],introduce:"",userId:"",uploadPicture:[],wxCode:"",title:"",createTime:0,phone:""}),c=e.reactive({id:"",nickname:"",imgURL:""}),p=e.ref(""),v=()=>{e.index.makePhoneCall({phoneNumber:t.phone})},y=()=>{e.index.setClipboardData({data:t.wxCode,success:function(){e.index.showToast({title:"\u6210\u529F\u590D\u5236\u5FAE\u4FE1\u53F7"})}})},u=e.ref(),m=e.ref([]),_=async()=>{await i.collection("comment").where(`found_id=='${t._id}'&&comment_type==0`).get().then(n=>{m.value=n.result.data})};e.onLoad(async n=>{i.collection("foundPet").where(`_id == '${n.id}'`).field("create_time as createTime, title,variety,name,gender,type,city,introduce,user_id as userId,uploadPicture,wx_code as wxCode,phone").get().then(o=>{Object.assign(t,o.result.data[0]),p.value=`comment_type==1&&found_id=='${t._id}'`}).then(()=>{i.collection("uni-id-users").where(`_id == '${t.userId}'`).field("nickname,avatar_file").get().then(o=>{c.id=o.result.data[0]._id,c.nickname=o.result.data[0].nickname,c.imgURL=o.result.data[0].avatar_file.url})}).then(()=>{i.collection("uni-id-users").where(`_id=='${a}'`).field("nickname,avatar_file").get().then(o=>{Object.assign(d,o.result.data[0])})}).then(()=>{l(),_()}).catch(o=>{console.log(o.message)})});const l=async()=>{await i.collection("collect").where(`user_id=='${a}'&&found_id=='${t._id}'`).get().then(n=>{n.result.data[0]?u.value=!0:u.value=!1})},C=()=>{u.value?i.collection("collect").where(`user_id=='${a}'&&found_id=='${t._id}'`).remove().then(()=>{l()}):e.pn.callFunction({name:"collect",data:{type:1,userId:a,foundId:t._id},success(){e.index.showToast({title:"\u6536\u85CF\u6210\u529F"}),l()},fail(n){console.log(n)}})};return(n,o)=>e.e({a:e.t(t.title),b:e.p({name:"clock",size:15}),c:e.p({date:t.createTime,format:"yyyy-MM-dd hh:mm:ss"}),d:e.t(t.name),e:e.t(t.variety),f:e.t(t.gender),g:e.t(t.type),h:e.t(t.city[0]),i:e.t(t.city[1]),j:e.t(t.city[2]),k:c.imgURL,l:e.t(c.nickname),m:e.o(y),n:e.p({name:"voipphone",size:25,color:"#ff9db1"}),o:e.o(v),p:!u.value},u.value?{}:{},{q:e.o(C),r:e.t(t.introduce),s:e.f(t.uploadPicture,(f,P,$)=>({a:f.path,b:f.fileId})),t:e.o(h),v:e.p({commentList:m.value,where:p.value}),w:e.sr("inputClose","dd90f0c0-5,dd90f0c0-4"),x:e.o(g),y:e.p({mode:"input",title:"\u8F93\u5165\u5185\u5BB9",placeholder:"\u5199\u4E0B\u4F60\u7684\u7EBF\u7D22\u5427"}),z:e.sr(s,"dd90f0c0-4",{k:"inputDialog"}),A:e.p({type:"dialog"})})}});var j=e._export_sfc(b,[["__scopeId","data-v-dd90f0c0"],["__file","C:/Users/yzc/Desktop/pet/pages/Home/Enlightenment/index.vue"]]);wx.createPage(j);
