"use strict";var e=require("../../../../../common/vendor.js");if(!Array){const _=e.resolveComponent("uni-dateformat"),n=e.resolveComponent("uni-icons"),a=e.resolveComponent("uni-popup");(_+n+a)()}const k=()=>"../../../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",C=()=>"../../../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",b=()=>"../../../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(k+C+j+b)();const j=()=>"../../../../../components/Message/index.js",$=e.defineComponent({__name:"index",setup(_){const n=e.pn.getCurrentUserInfo().uid,a=e.ref(null),v=e.ref(""),o=e.ref(),s=e.ref(),h=()=>{n?a.value.open("bottom"):e.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=weixin"})},y=()=>{a.value.close()},w=()=>{s.value?e.pn.callFunction({name:"comment",data:{type:0,comment:s.value,topicId:o.value,userId:n,avatarUrl:p.avatar_file.url,nickname:p.nickname},success(){s.value="",g(),a.value.close(),e.index.showToast({title:"\u8BC4\u8BBA\u6210\u529F",icon:"none"})},fail(t){console.log(t)}}):e.index.showToast({title:"\u8BF7\u8F93\u5165\u5185\u5BB9"})},r=e.reactive({avatar_file:{url:""},nickname:"",_id:""}),p=e.reactive({avatar_file:{url:""},nickname:"",_id:""}),u=e.reactive({content:"",image:[],user_id:"",create_time:0}),f=e.ref([]),i=e.pn.database(),l=e.ref(),m=()=>{i.collection("collect").where(`user_id=='${n}'&&topic_id=='${o.value}'`).get({getOne:!0}).then(t=>{t.result.data?l.value=!0:l.value=!1})},x=()=>{l.value?i.collection("collect").where(`user_id=='${n}'&&topic_id=='${o.value}'`).remove().then(()=>{m()}):e.pn.callFunction({name:"collect",data:{type:4,topicId:o.value,userId:n},success(){m(),e.index.showToast({title:"\u6210\u529F\u70B9\u8D5E"})}})},g=()=>{i.collection("comment").where(`topic_id=='${o.value}'&&comment_type==0`).get().then(t=>{f.value=t.result.data})};return e.onLoad(async t=>{o.value=t.id,await i.collection("topic").where(`_id=='${t.id}'`).field("image,content,user_id,create_time").get({getOne:!0}).then(c=>{Object.assign(u,c.result.data),v.value=`topic_id=='${o.value}'&&comment_type==1`,m()}).then(()=>{i.collection("uni-id-users").where(`_id=='${u.user_id}'`).field("nickname,avatar_file").get({getOne:!0}).then(c=>{Object.assign(r,c.result.data)})}).then(()=>{i.collection("uni-id-users").where(`_id=='${n}'`).field("nickname,avatar_file").get({getOne:!0}).then(c=>{Object.assign(p,c.result.data)})}).then(()=>{g()})}),(t,c)=>({a:r.avatar_file.url,b:e.t(r.nickname),c:e.p({date:u.create_time,format:"yyyy-MM-dd hh:mm:ss"}),d:e.t(u.content),e:e.f(u.image,(d,I,O)=>({a:d.path,b:I})),f:e.p({type:"info",size:"20",color:"#ccc"}),g:e.p({commentList:f.value,where:v.value}),h:e.o(h),i:e.o(x),j:e.p({type:"hand-up",size:"26",color:l.value?"#ec9312":"#ccc"}),k:e.o(y),l:e.p({type:"closeempty",size:"30"}),m:e.o(w),n:s.value,o:e.o(d=>s.value=d.detail.value),p:e.sr(a,"2179aa18-4",{k:"popup"}),q:e.p({type:"bottom"})})}});var B=e._export_sfc($,[["__scopeId","data-v-2179aa18"],["__file","C:/Users/yzc/Desktop/pet/pages/Home/Daily/CatDaily/TopicDetail/index.vue"]]);wx.createPage(B);
