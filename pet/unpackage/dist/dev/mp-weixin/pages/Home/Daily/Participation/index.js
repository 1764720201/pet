"use strict";var e=require("../../../../common/vendor.js");if(!Array){const a=e.resolveComponent("uni-forms-item"),n=e.resolveComponent("uni-file-picker"),o=e.resolveComponent("uni-forms");(a+n+o)()}const d=()=>"../../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",f=()=>"../../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js",p=()=>"../../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(d+f+p)();const g=e.defineComponent({__name:"index",setup(a){const n=e.reactive({content:"",imageList:[]}),o=e.pn.database(),u=e.ref(!1),c=e.ref();e.onLoad(t=>{t.id&&(u.value=!0,c.value=t.id,o.collection("topic").where(`_id=='${t.id}'`).get({getOne:!0}).then(r=>{const i=r.result.data;n.content=i.content,n.imageList=i.image}))});const m=e.pn.getCurrentUserInfo().uid,s=e.ref(null),l=e.reactive({content:{rules:[{required:!0,errorMessage:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:200,errorMessage:"\u6700\u5927\u957F\u5EA6\u4E3A200"}]},imageList:{rules:[{required:!0,errMessage:"\u56FE\u7247\u4E0D\u80FD\u4E3A\u7A7A"}]}}),_=()=>{u.value?s.value.validate().then(async()=>{await o.collection("topic").where(`_id=='${c.value}'`).update({content:n.content,image:n.imageList}).then(()=>{e.index.navigateBack({success(){e.index.showToast({title:"\u7F16\u8F91\u6210\u529F",icon:"none"})}})})}):s.value.validate().then(()=>{e.pn.callFunction({name:"topic",data:{imageList:n.imageList,userId:m,content:n.content,read:0},success(){e.index.showToast({title:"\u53D1\u5E03\u6210\u529F"}),e.index.navigateBack()},fail(t){console.log(t)}})})};return(t,r)=>({a:n.content,b:e.o(i=>n.content=i.detail.value),c:e.p({name:"content"}),d:e.o(i=>n.imageList=i),e:e.p({["file-mediatype"]:"image",mode:"grid",limit:6,modelValue:n.imageList}),f:e.p({name:"imageList"}),g:e.sr(s,"7069cbf7-0",{k:"form"}),h:e.p({modelValue:n,rules:l}),i:e.o(_)})}});var v=e._export_sfc(g,[["__scopeId","data-v-7069cbf7"],["__file","C:/Users/yzc/Desktop/pet/pages/Home/Daily/Participation/index.vue"]]);wx.createPage(v);
