"use strict";var e=require("../../../common/vendor.js");if(!Array){const c=e.resolveComponent("uni-badge"),r=e.resolveComponent("uni-icons"),d=e.resolveComponent("unicloud-db");(c+r+d)()}const g=()=>"../../../uni_modules/uni-badge/components/uni-badge/uni-badge.js",h=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",y=()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js";Math||(g+h+y)();const w=e.defineComponent({__name:"index",props:{hasLogin:{type:Boolean,required:!0},userId:{type:String,required:!0}},setup(c){const r=c,{hasLogin:d,userId:i}=e.toRefs(r);e.watch(()=>d.value,()=>{_()});const m=e.pn.database(),p=e.ref([]),a=e.reactive([]),_=async()=>{await m.collection("chat").where(`from_uid=='${i.value}'||to_uid=='${i.value}'`).groupBy("from_uid,to_uid").get().then(n=>{const u=new Set(...n.result.data.map(t=>Object.values(t).filter(b=>b!=i.value)));p.value=Array.from(u)}),p.value.forEach(n=>{m.collection("chat").where(`from_uid=='${n}'&&to_uid==$cloudEnv_uid&&is_read==false`).count().then(u=>{a.length=0,a.push({userId:n,unread:u.result.total})})})},f=n=>{e.index.navigateTo({url:`/pages/Chat/index?id=${n}`})};return e.onShow(()=>{_()}),e.index.onPushMessage(()=>{_()}),(n,u)=>({a:e.f(a,(t,b,o)=>({a:e.w(({data:s},v,l)=>({a:s==null?void 0:s.avatar_file.url,b:"c1d2b1d2-1-"+o+"-"+l+","+("c1d2b1d2-0-"+o),c:e.t(s==null?void 0:s.nickname),d:"c1d2b1d2-2-"+o+"-"+l+","+("c1d2b1d2-0-"+o),e:l,f:v}),{name:"d",path:"a["+o+"].a",vueId:"c1d2b1d2-0-"+o}),b:e.p({text:t.unread,absolute:"rightTop",size:"small",["max-num"]:99}),c:e.o(s=>f(t.userId)),d:"c1d2b1d2-0-"+o,e:e.p({collection:"uni-id-users",getone:!0,field:"nickname,avatar_file",where:`_id=='${t.userId}'`}),f:t.userId})),b:e.p({type:"forward",size:"23",color:"#bfbfbf"})})}});var x=e._export_sfc(w,[["__scopeId","data-v-c1d2b1d2"],["__file","C:/Users/yzc/Desktop/pet/pages/Message/News/index.vue"]]);wx.createComponent(x);
