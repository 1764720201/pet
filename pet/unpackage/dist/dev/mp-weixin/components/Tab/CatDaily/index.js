"use strict";var e=require("../../../common/vendor.js");if(!Array){const r=e.resolveComponent("uni-dateformat"),u=e.resolveComponent("tui-icon"),d=e.resolveComponent("uni-load-more");(r+u+d)()}const D=()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",T=()=>"../../../node-modules/thorui-uni/lib/thorui/tui-icon/tui-icon.js",j=()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js";Math||(D+T+j)();const A=e.defineComponent({__name:"index",props:{orderby:{type:String,required:!0}},setup(r){const u=r,{orderby:d}=e.toRefs(u),l=e.pn.getCurrentUserInfo().uid,m=e.ref(3),p=e.ref(),c=e.ref(!0);e.onShareAppMessage(t=>(t.from==="button"&&console.log(t.target),console.log(t),{title:"\u81EA\u5B9A\u4E49\u5206\u4EAB\u6807\u9898",path:"/pages/test/test?id=123"})),e.onReachBottom(()=>{m.value+=3,c.value=!0,i(),m.value>p.value&&(c.value=!1)});const g=e.ref([]),i=()=>{a.collection(C,"comment","uni-id-users","collect").limit(m.value).get({getCount:!0}).then(t=>{p.value=t.result.count,g.value=t.result.data})};e.onShow(()=>{i(),_()});const h=e.ref(),a=e.pn.database(),C=a.collection("topic").orderBy(d.value,"desc").getTemp(),b=e.ref([]),$=a.collection("uni-id-users").where(`_id=='${l}'`).field("_id").getTemp(),_=()=>{a.collection($,"collect").field("_id.collect as collect").get({getOne:!0}).then(t=>{b.value=t.result.data.collect.filter(n=>n.type==4&&n.user_id==l).map(n=>n.topic_id)})},f=e.ref(),w=async t=>{const n=async()=>{await a.collection("collect").where(`topic_id=='${t}'&&user_id=='${l}'`).get({getOne:!0}).then(o=>{o.result.data?f.value=!0:f.value=!1})};n().then(()=>{f.value?a.collection("collect").where(`topic_id=='${t}'&&user_id=='${l}'`).remove().then(()=>{_(),i(),n()}):e.pn.callFunction({name:"collect",data:{type:4,topicId:t,userId:l},success(){e.index.showToast({title:"\u70B9\u8D5E\u6210\u529F"}),_(),i(),n()},fail(o){console.log(o)}})})},y=t=>{e.index.navigateTo({url:`/pages/Home/Daily/CatDaily/TopicDetail/index?id=${t}`,async success(){await a.collection("topic").where(`_id=='${t}'`).field("read").get({getOne:!0}).then(n=>{h.value=n.result.data.read}),a.collection("topic").where(`_id=='${t}'`).update({read:h.value+1})},fail(n){console.log(n)}})};return(t,n)=>e.e({a:e.f(g.value,(o,M,v)=>({a:o.user_id[0].avatar_file.url,b:e.t(o.user_id[0].nickname),c:"5cbb5e1b-0-"+v,d:e.p({date:o.create_time,format:"MM-dd hh:mm"}),e:e.t(o.content),f:e.o(s=>y(o._id._value)),g:e.f(o.image,(s,x,k)=>({a:s.path,b:x})),h:e.o(s=>y(o._id._value)),i:"5cbb5e1b-1-"+v,j:e.p({name:"agree",size:"23",color:b.value.includes(o._id._value)?"#ec9312":"#ccc"}),k:e.t(o._id.collect.length),l:e.o(s=>w(o._id._value)),m:"5cbb5e1b-2-"+v,n:e.t(o._id.comment.length),o:o.create_time})),b:e.p({name:"message",size:"25"}),c:c.value},c.value?{d:e.p({status:"loading"})}:{},{e:!c.value},c.value?{}:{f:e.p({status:"noMore"})})}});var B=e._export_sfc(A,[["__scopeId","data-v-5cbb5e1b"],["__file","C:/Users/yzc/Desktop/pet/components/Tab/CatDaily/index.vue"]]);wx.createComponent(B);
