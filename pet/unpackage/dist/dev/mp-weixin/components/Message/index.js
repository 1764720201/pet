"use strict";var e=require("../../common/vendor.js");if(!Array){const s=e.resolveComponent("uni-dateformat"),p=e.resolveComponent("tui-icon"),r=e.resolveComponent("uni-popup-dialog"),a=e.resolveComponent("uni-popup");(s+p+r+a)()}const h=()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",k=()=>"../../node-modules/thorui-uni/lib/thorui/tui-icon/tui-icon.js",C=()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js",w=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(h+k+C+w)();const D=e.defineComponent({__name:"index",props:{commentList:{type:Array,required:!0},where:{type:String,required:!0}},setup(s){const p=s,{commentList:r,where:a}=e.toRefs(p);e.watch(()=>a.value,()=>{v()});const l=e.ref(null),f=e.pn.getCurrentUserInfo().uid,n=e.reactive({commentId:"",commentUserId:"",commentNickname:"",adoptId:"",foundId:"",topicId:""}),y=(t,d,o,g,u,i)=>{var _;n.commentId=t,n.commentNickname=o,n.commentUserId=d,n.adoptId=g,n.foundId=u,n.topicId=i,(_=l.value)==null||_.open("center")},I=e.pn.database(),m=e.reactive({avatar_file:{url:""},nickname:"",_id:""}),c=e.ref([]),v=async()=>{await I.collection("comment").where(a.value).field("nickname,comment,comment_id").get().then(t=>{c.value=t.result.data})};e.onLoad(async()=>{await I.collection("uni-id-users").where(`_id=='${f}'`).field("nickname,avatar_file").get({getOne:!0}).then(t=>{Object.assign(m,t.result.data)}).catch(t=>{console.log(t)})});const b=t=>{e.pn.callFunction({name:"comment",data:{comment:t,type:1,userId:f,adoptId:n.adoptId,nickname:m.nickname,avatarUrl:m.avatar_file.url,commentId:n.commentId,commentUserId:n.commentUserId,foundId:n.foundId,topicId:n.topicId},success(){v(),e.index.showToast({title:"\u56DE\u590D\u6210\u529F",icon:"none"})},fail(d){console.log(d)}})};return(t,d)=>({a:e.f(e.unref(r),(o,g,u)=>e.e({a:o.avatar_url,b:e.t(o.nickname),c:"1bbd567f-0-"+u,d:e.p({date:o.create_time,format:"yyyy-MM-dd hh:mm:ss"}),e:e.o(i=>y(o._id,o.user_id,o.nickname,o.adopt_id,o.found_id,o.topic_id)),f:"1bbd567f-1-"+u,g:e.t(o.comment)},c.value[0]?{h:e.f(c.value,(i,_,j)=>e.e({a:i.comment_id==o._id},i.comment_id==o._id?{b:e.t(i.nickname),c:e.t(i.comment)}:{},{d:i._id}))}:{},{i:o._id})),b:e.p({name:"message"}),c:c.value[0],d:e.sr("inputClose","1bbd567f-3,1bbd567f-2"),e:e.o(b),f:e.p({title:"\u56DE\u590D",mode:"input",placeholder:"@"+n.commentNickname}),g:e.sr(l,"1bbd567f-2",{k:"inputDialog"}),h:e.p({type:"dialog"})})}});var U=e._export_sfc(D,[["__scopeId","data-v-1bbd567f"],["__file","C:/Users/yzc/Desktop/pet/components/Message/index.vue"]]);wx.createComponent(U);
